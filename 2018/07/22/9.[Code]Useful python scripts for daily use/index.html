<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>Useful python scripts for daily uses - 太平塔</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">








    <meta name="description" content="Welcome to my collection of Python scripts and code snippets for everyday use. This document contains a variety of scripts and code snippets that can be used to automate repetitive tasks, process data">
<meta property="og:type" content="article">
<meta property="og:title" content="Useful python scripts for daily uses">
<meta property="og:url" content="http://envhyf.github.io/2018/07/22/9.[Code]Useful%20python%20scripts%20for%20daily%20use/index.html">
<meta property="og:site_name" content="太平塔">
<meta property="og:description" content="Welcome to my collection of Python scripts and code snippets for everyday use. This document contains a variety of scripts and code snippets that can be used to automate repetitive tasks, process data">
<meta property="og:locale">
<meta property="article:published_time" content="2018-07-22T14:26:26.000Z">
<meta property="article:modified_time" content="2025-03-23T16:38:57.000Z">
<meta property="article:author" content="Hao Yufang">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Visualization">
<meta name="twitter:card" content="summary">





<link rel="icon" href="/bugcatcher.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116955364-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-116955364-1');
</script>


    


<meta name="generator" content="Hexo 6.1.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    太平塔
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/categories/Research">Research</a>
            
            <a class="navbar-item "
               href="/categories/Tech">Tech</a>
            
            <a class="navbar-item "
               href="/categories/Life">Life</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="검색" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="GitHub" target="_blank" rel="noopener" href="https://github.com/envhyf/">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Useful python scripts for daily uses
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2018-07-22T14:26:26.000Z" itemprop="datePublished">7月 22 2018</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Tech/">Tech</a>
        </span>
        
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><p>Welcome to my collection of Python scripts and code snippets for everyday use. This document contains a variety of scripts and code snippets that can be used to automate repetitive tasks, process data, and perform various other operations. Whether you are a beginner or an experienced Python programmer, this collection of scripts and code snippets will provide you with useful tools and shortcuts for your everyday work.</p>
<p>In this document, you will find code snippets and scripts for tasks such as:</p>
<ul>
<li>Data processing</li>
<li>File manipulation</li>
<li>Web scraping</li>
<li>Automating tasks</li>
<li>And more!</li>
</ul>
<p>This document is organized into sections for easy navigation, so you can quickly find the script or code snippet that you need. Many of them were collected from <a target="_blank" rel="noopener" href="https://stackoverflow.com/">stackoverflow</a>. </p>
<p>On 2022.03.31, I re-organize all the scripts into Python 3.x version and post again.<br>On 2023.02.12, I edited the whole content with help from ChatGPT</p>
<span id="more"></span>

<h2 id="1-Data-processing"><a href="#1-Data-processing" class="headerlink" title=" 1.Data processing "></a><font color="blue"> 1.Data processing </font></h2><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#1. Find the duplicated values in one column</span></span><br><span class="line"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter   </span><br><span class="line"><span class="hljs-built_in">print</span> ([item <span class="hljs-keyword">for</span> item, count <span class="hljs-keyword">in</span> Counter(df[<span class="hljs-string">"Sample"</span>].values).items() <span class="hljs-keyword">if</span> count &gt;<span class="hljs-number">1</span>] )</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#2. Build new dataframe based on the user-defined column names</span></span><br><span class="line"><span class="hljs-comment">### N: length</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">new_df</span>(<span class="hljs-params">N, LIST</span>):</span><br><span class="line">    df = pd.DataFrame(np.nan, index=np.arange(<span class="hljs-number">0</span>,N,<span class="hljs-number">1</span>), columns=[<span class="hljs-string">'A'</span>])</span><br><span class="line">    <span class="hljs-keyword">for</span> i,t <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(LIST):</span><br><span class="line">        df[LIST[i]] = np.nan</span><br><span class="line">        df = df.drop([<span class="hljs-string">'A'</span>],<span class="hljs-number">1</span>)  </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#3. Change the integer to N digits </span></span><br><span class="line"><span class="hljs-comment">## method 1</span></span><br><span class="line"><span class="hljs-comment"># Method 1</span></span><br><span class="line">df.MONTH.apply(<span class="hljs-string">"{0:0=2d}"</span>.<span class="hljs-built_in">format</span>)</span><br><span class="line"><span class="hljs-comment"># Method 2</span></span><br><span class="line"><span class="hljs-string">"%02d"</span> &amp; (string)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#4. Replace the values in specific columns</span></span><br><span class="line">pd.options.mode.chained_assignment = <span class="hljs-literal">None</span></span><br><span class="line">df.loc[condition function, <span class="hljs-string">'column'</span>] = xxx  </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#5. Find the index of the nearest value to a pre-defined input</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">find_nearest</span>(<span class="hljs-params">array,value</span>):</span><br><span class="line">    idx = (np.<span class="hljs-built_in">abs</span>(array-value)).argmin()</span><br><span class="line">    <span class="hljs-keyword">return</span> array[idx]   </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#6. Test a value if it is NaN:      </span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">isNaN</span>(<span class="hljs-params">num</span>):</span><br><span class="line">    <span class="hljs-keyword">return</span> num != num</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#7. Test dataframe if it is empty</span></span><br><span class="line">df.empty==<span class="hljs-literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#8. Zip two pandas columns into 2-d array</span></span><br><span class="line"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product        </span><br><span class="line">c = <span class="hljs-built_in">list</span>(product(df.lon.values, df.lat.values))       </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#9. Manipulate the string</span></span><br><span class="line"><span class="hljs-comment">## Add an element</span></span><br><span class="line"><span class="hljs-built_in">list</span>.insert(<span class="hljs-number">0</span>, <span class="hljs-string">'A'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## Delete an element by index</span></span><br><span class="line"><span class="hljs-built_in">list</span>.pop(<span class="hljs-number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## Delete an element by its value</span></span><br><span class="line"><span class="hljs-built_in">list</span>.remove(<span class="hljs-string">'A'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#10. Assign value to specific location of a dataframe</span></span><br><span class="line"><span class="hljs-comment">## Method 1 - the fastest</span></span><br><span class="line">df.set_value(<span class="hljs-string">'row index'</span>, <span class="hljs-string">'column name'</span>, value)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## Method 2 - moderate speed</span></span><br><span class="line">df[<span class="hljs-string">'column name'</span>][<span class="hljs-string">'row index'</span>] = value</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## Method 3 - the slowest</span></span><br><span class="line">df.at(<span class="hljs-string">'column name'</span>, <span class="hljs-string">'row index'</span>) = value</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#11. Group the dataframe with user-defined range setting</span></span><br><span class="line">bins = [<span class="hljs-number">0</span>,<span class="hljs-number">50</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>, <span class="hljs-number">80</span>, <span class="hljs-number">90</span>,<span class="hljs-number">100</span>]</span><br><span class="line">group_names = [<span class="hljs-string">'&lt;50'</span>, <span class="hljs-string">'50-60'</span>, <span class="hljs-string">'60-70'</span>, <span class="hljs-string">'70-80'</span>,<span class="hljs-string">'80-90'</span>,<span class="hljs-string">'&gt;90'</span>]</span><br><span class="line">df[<span class="hljs-string">'categories'</span>] = pd.cut(df[<span class="hljs-string">'RH'</span>], bins, labels=group_names)</span><br><span class="line"><span class="hljs-comment">## If we want to plot them group-name wised</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(categories.unique())-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>):</span><br><span class="line">    ddf = df[df[<span class="hljs-string">'categories'</span>] == categories.unique()[i]]</span><br><span class="line">    plt.scatter(ddf[<span class="hljs-string">'PM2.5'</span>], ddf[<span class="hljs-string">'VISIBILITY'</span>], alpha = <span class="hljs-number">0.45</span>, label =<span class="hljs-string">'RH: '</span>+ roup_names[i])    </span><br><span class="line">    popt, pcov = curve_fit(func, ddf[<span class="hljs-string">"PM2.5"</span>], ddf[<span class="hljs-string">"VISIBILITY"</span>])        </span><br><span class="line">    xdata = np.arange(<span class="hljs-number">0</span>, <span class="hljs-number">300</span>, <span class="hljs-number">4</span>)</span><br><span class="line">    plt.plot(xdata, func(xdata, *popt),  zorder =<span class="hljs-number">3</span>)</span><br><span class="line">plt.legend(ncol = <span class="hljs-number">2</span>)    </span><br><span class="line">plt.show()    </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#12. Transform the list to string</span></span><br><span class="line"><span class="hljs-keyword">import</span> ast</span><br><span class="line">x = <span class="hljs-string">u'[ "A","B","C","D"]'</span></span><br><span class="line">x = ast.literal_eval(x)</span><br><span class="line"><span class="hljs-built_in">print</span> x  <span class="hljs-comment"># Output: ABCD</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#13. Subset of pandas dataframe by datetime range</span></span><br><span class="line">mask = (met[<span class="hljs-string">'Date'</span>] &lt; <span class="hljs-string">'2016-03-01'</span>)|(met[<span class="hljs-string">'Date'</span>] &gt;= <span class="hljs-string">'2016-12-01'</span>)</span><br><span class="line">met_sub = met.locmask</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#14. Sort one column by values of another column (ranking species by their concentrations)</span></span><br><span class="line">SE_COL = [<span class="hljs-string">'Cr'</span>, <span class="hljs-string">'Co'</span>, <span class="hljs-string">'Ni'</span>, <span class="hljs-string">'Cu'</span>, <span class="hljs-string">'Zn'</span>, <span class="hljs-string">'As'</span>, <span class="hljs-string">'Se'</span>, <span class="hljs-string">'Mo'</span>, <span class="hljs-string">'Cd'</span>, <span class="hljs-string">'Pb'</span>, <span class="hljs-string">'V'</span>, <span class="hljs-string">'Mg'</span>, <span class="hljs-string">'Ca'</span>, <span class="hljs-string">'K'</span>, <span class="hljs-string">'Ti'</span>, <span class="hljs-string">'Mn'</span>, <span class="hljs-string">'Fe'</span>, <span class="hljs-string">'Ba'</span>, <span class="hljs-string">'Sr'</span>]</span><br><span class="line">SE_COL = [SE_COL[t] <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.argsort(np.array([vals.dropna().mean() <span class="hljs-keyword">for</span> col, vals <span class="hljs-keyword">in</span> pm25_ef.items()]))]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#15. Drop np.nan and then find the 10th percentile</span></span><br><span class="line">v = df[<span class="hljs-string">'value'</span>].notna()</span><br><span class="line">ra_ = df.loc[v, <span class="hljs-string">'value'</span>].values</span><br><span class="line">se_index = ra_.argsort().argsort()[:<span class="hljs-built_in">int</span>(<span class="hljs-number">0.1</span><span class="hljs-built_in">len</span>(df))]</span><br><span class="line"><span class="hljs-built_in">sorted</span>(ra_)[<span class="hljs-built_in">int</span>(<span class="hljs-number">0.1</span><span class="hljs-built_in">len</span>(ra_))]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#16. Rename the columns of dataframe</span></span><br><span class="line">df.rename(columns={<span class="hljs-string">'oldName1'</span>: <span class="hljs-string">'newName1'</span>, <span class="hljs-string">'oldName2'</span>: <span class="hljs-string">'newName2'</span>}, inplace=<span class="hljs-literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#17. Delete specific columns</span></span><br><span class="line">columns = [<span class="hljs-string">'Col1'</span>, <span class="hljs-string">'Col2'</span>, ...]</span><br><span class="line">df.drop(columns=columns, inplace=<span class="hljs-literal">True</span>, axis = <span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#18. Add new columns</span></span><br><span class="line">df[new_column_name] = pd.Series(data, index=df.index)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#19. Delete the rows with np.nan</span></span><br><span class="line"><span class="hljs-comment">## Method 1</span></span><br><span class="line">df = df[~np.isfinite(<span class="hljs-string">'col1'</span>)]</span><br><span class="line"><span class="hljs-comment">## Method 2</span></span><br><span class="line">df.dropna(subset=[<span class="hljs-string">'col1'</span>], inplace=<span class="hljs-literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#20. Sort the values from the biggest</span></span><br><span class="line">var_exp = <span class="hljs-built_in">sorted</span>(eigen_vals, reverse=<span class="hljs-literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#21. Saving a CSV file containing Chinese characters</span></span><br><span class="line"><span class="hljs-comment">##To save a CSV file containing Chinese characters, you need to make sure that the file is encoded in UTF-8 format.</span></span><br><span class="line"><span class="hljs-keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="hljs-string">'utf-8'</span>)    </span><br><span class="line">df.to_csv(<span class="hljs-string">'file.csv'</span>, encoding=<span class="hljs-string">'utf-8-sig'</span>, index=<span class="hljs-literal">False</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#22. Adding a day to a datetime object</span></span><br><span class="line"><span class="hljs-comment">## To add one day to a datetime object, you can use the pd.to_timedelta() function. For example:</span></span><br><span class="line">date = pd.to_datetime(<span class="hljs-string">'2017-11-01'</span>)</span><br><span class="line">new_date = date + pd.to_timedelta(<span class="hljs-number">1</span>, <span class="hljs-string">'D'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#23. Getting the keys and values of a dictionary</span></span><br><span class="line">keys = [key <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> dict_.items()]</span><br><span class="line">values = [value <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> dict_.items()]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#24. Binning data with natural break</span></span><br><span class="line"><span class="hljs-keyword">from</span> pysal.esda.mapclassify <span class="hljs-keyword">import</span> Natural_Breaks <span class="hljs-keyword">as</span> nb</span><br><span class="line">breaks = nb(df.value,k=<span class="hljs-number">5</span>)</span><br><span class="line">class_ = pd.DataFrame({<span class="hljs-string">'class'</span>: breaks.yb}, index=df[df[<span class="hljs-string">'value'</span>].notnull()].index)</span><br><span class="line">df = df.join(class_)</span><br><span class="line">df.<span class="hljs-keyword">class</span>.fillna(-<span class="hljs-number">1</span>, inplace=<span class="hljs-literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#25. Printing a pandas DataFrame in Markdown format</span></span><br><span class="line"><span class="hljs-keyword">from</span> tabulate <span class="hljs-keyword">import</span> tabulate</span><br><span class="line"><span class="hljs-built_in">print</span>(tabulate(response_df, tablefmt=<span class="hljs-string">"pipe"</span>, headers=<span class="hljs-string">"keys"</span>, showindex=<span class="hljs-literal">False</span>))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#26. saving the 2-d array in txt and read it</span></span><br><span class="line">np.savetxt(<span class="hljs-string">"mask_PM_0.1x0.1.txt"</span>,mask)</span><br><span class="line">mask = np.loadtxt(<span class="hljs-string">'./mask_PM_0.1x0.1.txt'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#27. np.array dropna for the NaN of ratios </span></span><br><span class="line">t = np.array([(a/b) <span class="hljs-keyword">for</span> a, b <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(dyn_w[spec].values,dyn_s[spec].values)])</span><br><span class="line">t = t[~np.isnan(t)]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 28. How to select the data points within specific area</span></span><br><span class="line"><span class="hljs-comment">### 长三角</span></span><br><span class="line">yrd_area = fiona.<span class="hljs-built_in">open</span>(<span class="hljs-string">"./data/shp/YRD/yrd_b.shp"</span>)</span><br><span class="line">pol = yrd_area.<span class="hljs-built_in">next</span>()</span><br><span class="line"><span class="hljs-keyword">from</span> shapely.geometry <span class="hljs-keyword">import</span> shape</span><br><span class="line">geom = shape(pol[<span class="hljs-string">'geometry'</span>])</span><br><span class="line">poly_data = pol[<span class="hljs-string">"geometry"</span>][<span class="hljs-string">"coordinates"</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<span class="hljs-comment">#[0:12]</span></span><br><span class="line">poly = Polygon(poly_data)</span><br><span class="line">yrd_mask = np.array([poly.contains(Point(x,y)) <span class="hljs-keyword">for</span> x,y <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(data_city[<span class="hljs-string">'lon'</span>],data_city[<span class="hljs-string">'lat'</span>],)])</span><br><span class="line">data_yrd = data_city[yrd_mask]</span><br><span class="line">data_yrd = data_yrd.reset_index()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 29. 存储中文xls报错问题处理</span></span><br><span class="line">df = pd.read_csv(<span class="hljs-string">'./xxx.txt'</span>, delimiter = <span class="hljs-string">"\t"</span>,encoding=<span class="hljs-string">'utf-8'</span>)</span><br><span class="line"><span class="hljs-keyword">with</span> pd.ExcelWriter(<span class="hljs-string">'xxx.xls'</span>,options={<span class="hljs-string">'encoding'</span>:<span class="hljs-string">'utf-8'</span>}) <span class="hljs-keyword">as</span> writer:  <span class="hljs-comment">#</span></span><br><span class="line">    df.to_excel(writer, sheet_name=<span class="hljs-string">u'sheet1'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 30. split the list by specfic string (e.g., quotes)</span></span><br><span class="line">[s <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> l.split(<span class="hljs-string">'"'</span>) <span class="hljs-keyword">if</span> s.strip() != <span class="hljs-string">''</span>][<span class="hljs-number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 31. replace specific values by condition </span></span><br><span class="line">df.loc[df[<span class="hljs-string">'COLA'</span>]!=<span class="hljs-string">'XXX'</span>,<span class="hljs-string">'COLB'</span>]=yyy</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 32. Select subset of netcdf file by specific attributes</span></span><br><span class="line"><span class="hljs-keyword">import</span> netCDF4 <span class="hljs-keyword">as</span> nc</span><br><span class="line">val_ = [<span class="hljs-string">'HGT_M'</span>, <span class="hljs-string">'XLONG_C'</span>,<span class="hljs-string">'XLAT_C'</span>]</span><br><span class="line"><span class="hljs-keyword">with</span> netCDF4.Dataset(<span class="hljs-string">"geo_em.d01.nc"</span>) <span class="hljs-keyword">as</span> src, netCDF4.Dataset(<span class="hljs-string">"out.nc"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> dst:</span><br><span class="line">    <span class="hljs-comment"># copy global attributes all at once via dictionary</span></span><br><span class="line">    dst.setncatts(src.__dict__)</span><br><span class="line">    <span class="hljs-comment"># copy dimensions</span></span><br><span class="line">    <span class="hljs-keyword">for</span> name, dimension <span class="hljs-keyword">in</span> src.dimensions.items():</span><br><span class="line">        dst.createDimension(</span><br><span class="line">            name, (<span class="hljs-built_in">len</span>(dimension) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> dimension.isunlimited() <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>))</span><br><span class="line">    <span class="hljs-comment"># copy all file data except for the excluded</span></span><br><span class="line">    <span class="hljs-keyword">for</span> name, variable <span class="hljs-keyword">in</span> src.variables.items():</span><br><span class="line">        <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> val_:</span><br><span class="line">            x = dst.createVariable(name, variable.datatype, variable.dimensions)</span><br><span class="line">            dst[name][:] = src[name][:]</span><br><span class="line">            <span class="hljs-comment"># copy variable attributes all at once via dictionary</span></span><br><span class="line">            dst[name].setncatts(src[name].__dict__)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 33. combining the lists</span></span><br><span class="line">code_ = []</span><br><span class="line"><span class="hljs-keyword">for</span> pr <span class="hljs-keyword">in</span> pc_code:</span><br><span class="line">    code_ = <span class="hljs-built_in">list</span>(itertools.chain.from_iterable([code_,[t[<span class="hljs-string">'code'</span>] <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> pr[<span class="hljs-string">'children'</span>]]]))    </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 34. 2-D数据插值</span></span><br><span class="line"><span class="hljs-comment">#向新网格进行插值</span></span><br><span class="line"><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> interpolate</span><br><span class="line">hfunc = interpolate.interp2d(lon_dust_sub,lat_dust_sub,PM_dust)</span><br><span class="line">new_dust = np.zeros(<span class="hljs-built_in">len</span>(lat_anthr_sub)*<span class="hljs-built_in">len</span>(lon_anthr_sub))</span><br><span class="line">t =  <span class="hljs-number">0</span> </span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(lat_anthr_sub),<span class="hljs-number">1</span>):</span><br><span class="line">    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(lon_anthr_sub),<span class="hljs-number">1</span>):</span><br><span class="line">        new_dust[t] = hfunc(lon_anthr_sub[j],lat_anthr_sub[i])</span><br><span class="line">        t+=<span class="hljs-number">1</span></span><br><span class="line">dust_int = new_dust.reshape(<span class="hljs-built_in">len</span>(lat_anthr_sub),<span class="hljs-built_in">len</span>(lon_anthr_sub))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 35. 排序获得其序列index</span></span><br><span class="line"><span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)), key=<span class="hljs-keyword">lambda</span> k: s[k])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 39. Sort时注意排序</span></span><br><span class="line">sorter = source_</span><br><span class="line">df_contr_cr.source = df_contr_cr.source.astype(<span class="hljs-string">"category"</span>)</span><br><span class="line">df_contr_cr.source.cat.set_categories(sorter, inplace=<span class="hljs-literal">True</span>)</span><br><span class="line">df_contr_cr = df_contr_cr.sort_values([<span class="hljs-string">"source"</span>]) </span><br><span class="line"></span><br><span class="line">df[<span class="hljs-string">'categories'</span>].value_counts().reindex(group_names)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 39. 分钟数据转化为小时数据</span></span><br><span class="line">df2_re = df2.groupby(np.arange(<span class="hljs-built_in">len</span>(df2))//<span class="hljs-number">60.0</span>).mean()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 40. 有效位数输出</span></span><br><span class="line">to_clipboard(float_format = <span class="hljs-string">'%.4f'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 41.自然基金报告下载</span></span><br><span class="line"><span class="hljs-keyword">import</span> os</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>,<span class="hljs-number">1</span>):</span><br><span class="line">    os.system(<span class="hljs-string">"wget http://output.nsfc.gov.cn/report/41/41205122_%i.png"</span> %i)    </span><br><span class="line"><span class="hljs-keyword">import</span> os</span><br><span class="line"><span class="hljs-keyword">import</span> natsort</span><br><span class="line"><span class="hljs-keyword">from</span> fpdf <span class="hljs-keyword">import</span> FPDF</span><br><span class="line"></span><br><span class="line">files = os.listdir(<span class="hljs-string">'./'</span>)</span><br><span class="line">files = natsort.natsorted(files, reverse = <span class="hljs-literal">False</span>)</span><br><span class="line">files = files[<span class="hljs-number">0</span>:]</span><br><span class="line">pdf = FPDF()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> image <span class="hljs-keyword">in</span> files[<span class="hljs-number">0</span>:]: </span><br><span class="line">    <span class="hljs-keyword">if</span> image[-<span class="hljs-number">3</span>:]==<span class="hljs-string">'png'</span>: </span><br><span class="line">        pdf.add_page()  </span><br><span class="line">        pdf.image(image,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">210</span>,<span class="hljs-number">297</span>)  </span><br><span class="line">pdf.output(<span class="hljs-string">"../hh.pdf"</span>, <span class="hljs-string">"F"</span>)   </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 43. 缺失值监测</span></span><br><span class="line">pd.isnull()</span><br><span class="line">dataframe[xxx].values.isnull()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 44. If Else in list comprehension</span></span><br><span class="line">[x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">list</span>(df.columns[<span class="hljs-number">2</span>:]) <span class="hljs-keyword">if</span> x <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">'重庆'</span>,<span class="hljs-string">'山西'</span>,<span class="hljs-string">'西藏'</span>]]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 45. Two variables in list comprehension (double iteration)</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 46. assign two value to pandas columns with if condition.</span></span><br><span class="line">contr_df[<span class="hljs-string">'type'</span>] = contr_df[<span class="hljs-string">'sample'</span>].apply(<span class="hljs-keyword">lambda</span> x:<span class="hljs-number">10</span> <span class="hljs-keyword">if</span> x[<span class="hljs-number">0</span>:<span class="hljs-number">7</span>] ==<span class="hljs-string">"IITK-20"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"x"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 46. txt file reading with multiple delimiter and skiplines</span></span><br><span class="line">df = pd.read_csv(<span class="hljs-string">'./data/210717_Lucknow_Day1.txt'</span>,delimiter=<span class="hljs-string">'\t'</span>,skiprows=[i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>)])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 47. add multiple lists as the columns of new dataframe</span></span><br><span class="line">dpara = pd.DataFrame(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">zip</span>(t_series,rn_series,minErr1ion)),columns=[<span class="hljs-string">'t_series'</span>,<span class="hljs-string">'rn_series'</span>,<span class="hljs-string">'minErr1ion'</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 48. replace all the quotation mark in the column</span></span><br><span class="line">species_name  =  [<span class="hljs-built_in">str</span>(c.rstrip().split(<span class="hljs-string">"\t"</span>)[<span class="hljs-number">1</span>].replace(<span class="hljs-string">'"'</span>, <span class="hljs-string">''</span>)) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> species_info1]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 49. Kruskal-Wallis test</span></span><br><span class="line"><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats</span><br><span class="line">stats.kruskal(dd[<span class="hljs-string">'Glass vial'</span>],dd[<span class="hljs-string">'Plastical vial'</span>],dd[<span class="hljs-string">'Dilution water'</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 50. list substraction</span></span><br><span class="line"><span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>( <span class="hljs-built_in">list</span>(dafr_no3.columns)) - <span class="hljs-built_in">set</span>(spike_cols)-<span class="hljs-built_in">set</span>([<span class="hljs-string">'time'</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 51. Assign 2-d matrix into pandas dataframe with column name</span></span><br><span class="line">     dafr_org = pd.DataFrame(org_, columns=df_org[<span class="hljs-string">'Parameter'</span>].attrs[<span class="hljs-string">'ExactMassText'</span>].astype(<span class="hljs-built_in">str</span>))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 52. divide string based on chemical formula     </span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line">c = <span class="hljs-string">'C2H3O'</span></span><br><span class="line">splitted = <span class="hljs-built_in">list</span>(re.split(<span class="hljs-string">"([A-Z][a-z]*)"</span>,c))</span><br><span class="line">keyss = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> a: a[<span class="hljs-number">0</span>].isupper() <span class="hljs-keyword">if</span> a <span class="hljs-keyword">else</span> <span class="hljs-literal">False</span>, splitted))</span><br><span class="line">values = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> a: a[<span class="hljs-number">0</span>].isdigit() <span class="hljs-keyword">if</span> a <span class="hljs-keyword">else</span> <span class="hljs-literal">False</span>, splitted))</span><br><span class="line">spec_dict = <span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(keyss,values)) </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 53. check string type in columns</span></span><br><span class="line">na_em_power.applymap(<span class="hljs-built_in">type</span>)==<span class="hljs-built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 54. Sorting files by specific strings witin the filename</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">last_4chars</span>(<span class="hljs-params">x</span>):</span><br><span class="line">    <span class="hljs-keyword">return</span>(x[-<span class="hljs-number">25</span>:])</span><br><span class="line"></span><br><span class="line"><span class="hljs-built_in">sorted</span>(imgs, key = last_4chars)   </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 55. split string by more than one delimiters</span></span><br><span class="line"><span class="hljs-keyword">import</span> re</span><br><span class="line">re.split(<span class="hljs-string">'; |, '</span>, string_to_split)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 56. Pandas rename multiple columns</span></span><br><span class="line">df_area.rename(columns=<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(df_area.columns[:], mz_list)),inplace=<span class="hljs-literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 57. Pandas check whether the whole column is np.nan</span></span><br><span class="line"><span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> mz_list[<span class="hljs-number">0</span>:]:</span><br><span class="line">    <span class="hljs-keyword">if</span> df_area[c].isnull().<span class="hljs-built_in">all</span>():</span><br><span class="line">        <span class="hljs-built_in">print</span>(<span class="hljs-string">"All values in the column 'B' are NaN"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 58. Rename part of column names by condition</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">renaming_fun</span>(<span class="hljs-params">a</span>):</span><br><span class="line">    <span class="hljs-keyword">if</span> <span class="hljs-string">"_unc_new_toc_scaled"</span> <span class="hljs-keyword">in</span> a:</span><br><span class="line">        <span class="hljs-keyword">return</span> a.split(<span class="hljs-string">'_'</span>)[<span class="hljs-number">0</span>] +<span class="hljs-string">"_unc"</span> <span class="hljs-comment"># or None</span></span><br><span class="line">    <span class="hljs-keyword">return</span> a</span><br><span class="line">auto_df_fa.columns = [renaming_fun(col) <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> auto_df_fa.columns]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 58. Append 2-d array into 3-d array</span></span><br><span class="line"><span class="hljs-comment">### https://stackoverflow.com/questions/43363641/building-a-3d-array-from-a-number-of-2d-arrays-with-numpy</span></span><br><span class="line">OC_emissions_daily  = np.empty((<span class="hljs-number">1</span>,<span class="hljs-number">720</span>, <span class="hljs-number">1440</span>), <span class="hljs-built_in">int</span>)</span><br><span class="line">daily_em_array      = month_OC_emissions * daily_fraction</span><br><span class="line">OC_emissions_daily  = np.vstack([OC_emissions_daily, daily_em_array[<span class="hljs-literal">None</span>]])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 59. processing pandas multiple columns </span></span><br><span class="line">df[df.columns[<span class="hljs-number">2</span>:]] = df[df.columns[<span class="hljs-number">2</span>:]].multiply(spi_conc/RIE/c, axis=<span class="hljs-string">"index"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 60. Lambda function</span></span><br><span class="line"><span class="hljs-comment">### Apply function NumPy.square() to square the values of two rows 'A'and'B</span></span><br><span class="line">df2 = df.apply(<span class="hljs-keyword">lambda</span> x: np.square(x) <span class="hljs-keyword">if</span> x.name <span class="hljs-keyword">in</span> [<span class="hljs-string">'A'</span>,<span class="hljs-string">'B'</span>] <span class="hljs-keyword">else</span> x)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 61. Saving n-d array and reload via pickle method</span></span><br><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line"><span class="hljs-keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 62. create a large numpy array</span></span><br><span class="line">data = np.random.rand(<span class="hljs-number">1000</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 63. save the numpy array to a file using pickle</span></span><br><span class="line"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'data.pkl'</span>, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:</span><br><span class="line">    pickle.dump(data, f)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 64. load the numpy array from the file</span></span><br><span class="line"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'data.pkl'</span>, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:</span><br><span class="line">    loaded_data = pickle.load(f)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 65. check if the original and loaded numpy arrays are the same</span></span><br><span class="line"><span class="hljs-built_in">print</span>(np.array_equal(data, loaded_data))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 66. Daily average</span></span><br><span class="line">df.set_index(<span class="hljs-string">'datetime'</span>,inplace=<span class="hljs-literal">True</span>)</span><br><span class="line">df = df.rename(columns=new_column_names)</span><br><span class="line">daily_ave = df.resample(<span class="hljs-string">'D'</span>).mean()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 67. Create a Pandas Excel writer using 'xlsxwriter' engine</span></span><br><span class="line"><span class="hljs-keyword">with</span> pd.ExcelWriter(<span class="hljs-string">'my_excel_file.xlsx'</span>, engine=<span class="hljs-string">'xlsxwriter'</span>) <span class="hljs-keyword">as</span> writer:</span><br><span class="line">    <span class="hljs-comment"># Write dataframes df1 and df2 to two separate sheets in the same Excel file</span></span><br><span class="line">    df1.to_excel(writer, sheet_name=<span class="hljs-string">'Sheet1'</span>)</span><br><span class="line">    df2.to_excel(writer, sheet_name=<span class="hljs-string">'Sheet2'</span>)</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="hljs-comment"># 68. Simple way to classify chemical formula</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">classify_chemicals</span>(<span class="hljs-params">formula</span>): </span><br><span class="line">     <span class="hljs-keyword">if</span> pd.isnull(formula): </span><br><span class="line">         <span class="hljs-keyword">return</span> np.nan </span><br><span class="line">     <span class="hljs-keyword">else</span>: </span><br><span class="line">         elements = [<span class="hljs-string">'C'</span>, <span class="hljs-string">'H'</span>, <span class="hljs-string">'O'</span>, <span class="hljs-string">'N'</span>, <span class="hljs-string">'Na'</span>\] </span><br><span class="line">         components = re.findall(<span class="hljs-string">'\[A-Z\]\[a-z\]*'</span>, formula) </span><br><span class="line">         <span class="hljs-comment"># Split formula into components </span></span><br><span class="line">         category = <span class="hljs-string">''</span>.join(\[element <span class="hljs-keyword">for</span> element <span class="hljs-keyword">in</span> elements <span class="hljs-keyword">if</span> element <span class="hljs-keyword">in</span> components]) </span><br><span class="line">     <span class="hljs-keyword">return</span> category </span><br><span class="line">ds[<span class="hljs-string">'Ion-rule1-class'</span>] = ds[<span class="hljs-string">'ion-rule1'</span>].apply(classify_chemicals)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="2-Data-statistics"><a href="#2-Data-statistics" class="headerlink" title=" 2. Data statistics  "></a><font color="blue"> 2. Data statistics  </font></h2><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#1. Curve fitting (y = ax + b)</span></span><br><span class="line"><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats</span><br><span class="line"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np</span><br><span class="line">slope, intercept, r_value, p_value, std_err = stats.linregress(x,y)</span><br><span class="line"><span class="hljs-comment">##1.1 remove the nan value first!</span></span><br><span class="line">mask = ~np.isnan(x_) &amp; ~np.isnan(y_)</span><br><span class="line">slope, intercept, r_value, p_value, std_err = stats.linregress(x_[mask], y_[mask])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#2. Fitting by user-defined function </span></span><br><span class="line"><span class="hljs-keyword">from</span> scipy.optimize <span class="hljs-keyword">import</span> curve_fit        </span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">func</span>(<span class="hljs-params">x, a,b</span>):</span><br><span class="line">    <span class="hljs-keyword">return</span> ax**<span class="hljs-number">2</span>+bx<span class="hljs-comment">#+0.55</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">get_r</span>(<span class="hljs-params">f,x,y,popt</span>):</span><br><span class="line">    residuals = y- f(x, *popt)</span><br><span class="line">    ss_res = np.<span class="hljs-built_in">sum</span>(residuals**<span class="hljs-number">2</span>)    </span><br><span class="line">    ss_tot = np.<span class="hljs-built_in">sum</span>((y-np.mean(y))**<span class="hljs-number">2</span>)    </span><br><span class="line">    r_squared = <span class="hljs-number">1</span> - (ss_res / ss_tot)</span><br><span class="line">    <span class="hljs-keyword">return</span> r_squared</span><br><span class="line">popt, pcov = curve_fit(func, df[<span class="hljs-string">'x'</span>], df[<span class="hljs-string">'y'</span>]) </span><br><span class="line"><span class="hljs-built_in">print</span> <span class="hljs-string">"## f(x) = ax*2 +bx ##"</span></span><br><span class="line"><span class="hljs-built_in">print</span> <span class="hljs-string">"## a##"</span></span><br><span class="line"><span class="hljs-built_in">print</span> popt</span><br><span class="line"><span class="hljs-built_in">print</span> <span class="hljs-string">"## r-square ##"</span></span><br><span class="line"><span class="hljs-built_in">print</span> get_r(func,df[<span class="hljs-string">'x'</span>], df[<span class="hljs-string">'y'</span>], popt )</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#3. pivot table </span></span><br><span class="line">df.groupby([<span class="hljs-string">'site'</span>]).get_group(df.site.unique()[i])[<span class="hljs-string">'value'</span>].mean()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#4. Summarize the frequency</span></span><br><span class="line">clu_d[<span class="hljs-string">'Cluster'</span>].value_counts().to_frame()</span><br><span class="line">clu_d[<span class="hljs-string">'Cluster'</span>].value_counts().index.tolist()  </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#5. one-way ANOVA test</span></span><br><span class="line"><span class="hljs-comment"># 如何统计 seasonal anova difference</span></span><br><span class="line">spec_ = [<span class="hljs-string">'crustal'</span>,<span class="hljs-string">'trace'</span>,<span class="hljs-string">'OM'</span>,<span class="hljs-string">"EC"</span>,<span class="hljs-string">'SO42-'</span>,<span class="hljs-string">'NO3-'</span>,<span class="hljs-string">'Cl-'</span>,<span class="hljs-string">'NH4+'</span>,<span class="hljs-string">'n_K'</span>,]</span><br><span class="line">val_annual,val_sp,val_su,val_au,val_wi = [],[],[],[],[]</span><br><span class="line"><span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> sp_pie:</span><br><span class="line">    val_sp=df[df.season==<span class="hljs-string">'Spring'</span>][t].dropna().values</span><br><span class="line">    val_su=df[df.season==<span class="hljs-string">'Summer'</span>][t].dropna().values</span><br><span class="line">    val_au=df[df.season==<span class="hljs-string">'Autumn'</span>][t].dropna().values</span><br><span class="line">    val_wi=df[df.season==<span class="hljs-string">'Winter'</span>][t].dropna().values</span><br><span class="line">    <span class="hljs-built_in">print</span> t</span><br><span class="line">    <span class="hljs-built_in">print</span> stats.f_oneway(val_sp,val_su, val_au,val_wi)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># pearson correlation </span></span><br><span class="line">mask = ~np.isnan(df[<span class="hljs-string">'Ma_re'</span>])&amp;~np.isnan(df[<span class="hljs-string">'PM25'</span>])</span><br><span class="line">stats.pearsonr(df[<span class="hljs-string">'Ma_re'</span>][mask],df[<span class="hljs-string">'PM25'</span>][mask])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 6. D-N averaged</span></span><br><span class="line">sample_id = df_op[df_op[<span class="hljs-string">'Sample ID'</span>].<span class="hljs-built_in">str</span>[-<span class="hljs-number">1</span>] !=<span class="hljs-string">'C'</span>][<span class="hljs-string">'Sample ID'</span>].values</span><br><span class="line"><span class="hljs-comment">#IITK-2018-02-12-N #IITK-2018-01-21-N</span></span><br><span class="line">sample_id = [c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> sample_id <span class="hljs-keyword">if</span> c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">'IITK-2018-02-12-N'</span> ,<span class="hljs-string">'IITK-2018-01-21-N'</span>,]]</span><br><span class="line"></span><br><span class="line">df_op_c = df_op[~(df_op[<span class="hljs-string">'Sample ID'</span>].isin(sample_id))]</span><br><span class="line">df_op_c  = df_op_c[df_op_c[<span class="hljs-string">'Sample ID'</span>]!=<span class="hljs-string">'IITK-2018-11-01-C'</span>]</span><br><span class="line"></span><br><span class="line">df_op_dn = pd.DataFrame()</span><br><span class="line">df_op_dn[<span class="hljs-string">'Sample ID'</span>] = [c[:-<span class="hljs-number">2</span>]+<span class="hljs-string">'-C'</span> <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> sample_id]</span><br><span class="line">df_op_dn[<span class="hljs-string">'Date'</span>] =  [c[<span class="hljs-number">5</span>:-<span class="hljs-number">2</span>] <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> sample_id]</span><br><span class="line"><span class="hljs-keyword">for</span> co <span class="hljs-keyword">in</span> df_op.columns[<span class="hljs-number">2</span>:]:</span><br><span class="line">    val_ = []</span><br><span class="line">    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> sample_id:</span><br><span class="line">        val_.append(df_op[df_op[<span class="hljs-string">'Sample ID'</span>].<span class="hljs-built_in">str</span>[:-<span class="hljs-number">2</span>] == c[:-<span class="hljs-number">2</span>]][co].mean())</span><br><span class="line">    df_op_dn[co] = val_</span><br><span class="line">    </span><br><span class="line">df_op_new = pd.concat([df_op_dn,df_op_c]).reset_index(drop=<span class="hljs-literal">True</span>)    </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## OM:OC</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> pyvalem.formula <span class="hljs-keyword">import</span> Formula</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">cal_omoc</span>(<span class="hljs-params">ion</span>):</span><br><span class="line">    f         = Formula(ion)</span><br><span class="line">    atom_dict = f.atom_stoich</span><br><span class="line">    n_c       = atom_dict[<span class="hljs-string">'C'</span>]</span><br><span class="line">    omoc_ratio = f.mass/(n_c*<span class="hljs-number">12.0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">return</span> omoc_ratio</span><br><span class="line">pro_pr[<span class="hljs-string">'OM:OC'</span>] = pro_pr[<span class="hljs-string">'Ion'</span>].apply(<span class="hljs-keyword">lambda</span> ion: cal_omoc(ion))</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="3-Data-visualization"><a href="#3-Data-visualization" class="headerlink" title=" 3. Data visualization  "></a><font color="blue"> 3. Data visualization  </font></h2><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#1. Temperature symbol</span></span><br><span class="line">ax.set_ylabel(<span class="hljs-string">u'Temperature (\N{DEGREE SIGN}C)'</span>, fontweight=<span class="hljs-string">'bold'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#2. Match the length of colorbar with the figure</span></span><br><span class="line"><span class="hljs-keyword">from</span> mpl_toolkits.axes_grid1 <span class="hljs-keyword">import</span> make_axes_locatable</span><br><span class="line">divider = make_axes_locatable(ax1)</span><br><span class="line">cax = divider.append_axes(<span class="hljs-string">"right"</span>, size=<span class="hljs-string">"5%"</span>, pad=<span class="hljs-number">0.1</span>)</span><br><span class="line">cbar = plt.colorbar(cf, cax=cax)    </span><br><span class="line">cbarlabel = <span class="hljs-string">"xxxx"</span></span><br><span class="line">cbar.ax.set_xlabel(cbarlabel,size = <span class="hljs-number">8</span>,labelpad=-<span class="hljs-number">35</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#3. User-defined colorbar location and ticklabel editting</span></span><br><span class="line">cbaxes = fig.add_axes([<span class="hljs-number">0.83</span>, <span class="hljs-number">0.125</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.01</span>]) </span><br><span class="line">cbar = plt.colorbar(ss,cax=cbaxes,orientation=<span class="hljs-string">'horizontal'</span>)</span><br><span class="line">loc_ = np.array([<span class="hljs-number">5</span>,<span class="hljs-number">10</span>,<span class="hljs-number">15</span>,<span class="hljs-number">20</span>,<span class="hljs-number">25</span>])</span><br><span class="line">cbar.set_ticks(loc_)</span><br><span class="line">cbar.set_ticklabels(loc_)</span><br><span class="line"><span class="hljs-comment">## two methods for ticklabel fontsize</span></span><br><span class="line">(<span class="hljs-number">1</span>) cbar.ax.tick_params(labelsize=<span class="hljs-number">8</span>)</span><br><span class="line">(<span class="hljs-number">2</span>) cbar.ax.set_xticklabels(cbar.ax.get_xticklabels(), fontsize=<span class="hljs-number">8</span>)</span><br><span class="line">cbar.ax.set_xlabel(<span class="hljs-string">r'$\mathregular{OC/EC}$'</span>,fontsize = <span class="hljs-number">8</span>,labelpad = -<span class="hljs-number">28</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#4. Chinese setting</span></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib.font_manager <span class="hljs-keyword">import</span> FontProperties </span><br><span class="line">mpl.rcParams[<span class="hljs-string">'font.sans-serif'</span>] = [<span class="hljs-string">'Microsoft YaHei'</span>]<span class="hljs-comment"># 微软雅黑的中英文混排效果较好</span></span><br><span class="line">plt.rcParams[<span class="hljs-string">'axes.unicode_minus'</span>] = <span class="hljs-literal">False</span>  </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#5. User-defined axes setting</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">stylize_axes</span>(<span class="hljs-params">ax</span>):</span><br><span class="line">    ax.spines[<span class="hljs-string">'top'</span>].set_visible(<span class="hljs-literal">False</span>)</span><br><span class="line">    ax.spines[<span class="hljs-string">'right'</span>].set_visible(<span class="hljs-literal">False</span>)</span><br><span class="line">    ax.xaxis.set_tick_params(top=<span class="hljs-string">'off'</span>, direction=<span class="hljs-string">'out'</span>, width=<span class="hljs-number">1</span>)</span><br><span class="line">    ax.yaxis.set_tick_params(right=<span class="hljs-string">'off'</span>, direction=<span class="hljs-string">'out'</span>, width=<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#6. Plotting the first-order regression line</span></span><br><span class="line"><span class="hljs-comment">## (x,y) is the original datasets</span></span><br><span class="line"><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats</span><br><span class="line">slope, intercept, r_value, p_value, slope_std_error = stats.linregress(x, y)</span><br><span class="line">xx = np.arange(x.<span class="hljs-built_in">min</span>(),x,<span class="hljs-built_in">max</span>(),<span class="hljs-number">0.01</span>)</span><br><span class="line">yy = slope*xx+intercept</span><br><span class="line">clabel = <span class="hljs-comment"># make the font itatilc style</span></span><br><span class="line">plt.plot(xx,yy,color =<span class="hljs-string">'k'</span>, lw =<span class="hljs-number">1.2</span>, linestyle = <span class="hljs-string">"-"</span>, label = clabel)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#7. Setting the two subplots shared the same aspect ratio</span></span><br><span class="line"><span class="hljs-comment">## Noted that when one subplot using basemap or cartopy (geo-based coordinate), and the other subplot is in basic matplotlib style, there aspect ratio would not be the same. </span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">get_aspect</span>(<span class="hljs-params">ax</span>):</span><br><span class="line">    xlim = ax.get_xlim()</span><br><span class="line">    ylim = ax.get_ylim()</span><br><span class="line">    aspect_ratio = <span class="hljs-built_in">abs</span>((ylim[<span class="hljs-number">0</span>]-ylim[<span class="hljs-number">1</span>]) / (xlim[<span class="hljs-number">0</span>]-xlim[<span class="hljs-number">1</span>]))</span><br><span class="line">    <span class="hljs-keyword">return</span> aspect_ratio</span><br><span class="line">fig = plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">8</span>))</span><br><span class="line">ax1=plt.subplot(<span class="hljs-number">121</span>, projection=ccrs.PlateCarree())</span><br><span class="line">ax2=plt.subplot(<span class="hljs-number">122</span>)</span><br><span class="line">ax2.set_aspect(get_aspect(ax1) / get_aspect(ax2))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#8. Fake legend markers</span></span><br><span class="line"><span class="hljs-comment">#参考 https://jakevdp.github.io/PythonDataScienceHandbook/04.06-customizing-legends.html</span></span><br><span class="line"><span class="hljs-keyword">for</span> area <span class="hljs-keyword">in</span> [<span class="hljs-number">100</span>, <span class="hljs-number">300</span>, <span class="hljs-number">500</span>]:</span><br><span class="line">    plt.scatter([], [], c=<span class="hljs-string">'k'</span>, alpha=<span class="hljs-number">0.3</span>, s=area,</span><br><span class="line">                label=<span class="hljs-built_in">str</span>(area) + <span class="hljs-string">' km$^2$'</span>)</span><br><span class="line">plt.legend(scatterpoints=<span class="hljs-number">1</span>, frameon=<span class="hljs-literal">False</span>, labelspacing=<span class="hljs-number">1</span>, title=<span class="hljs-string">'City Area'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#9. Remove the plotting items and retain the label</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#10. Remove the tick lines while retain the ticklabels</span></span><br><span class="line">ax.tick_params(axis=<span class="hljs-string">u'both'</span>, which=<span class="hljs-string">u'both'</span>,length=<span class="hljs-number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#11. plotting two subplots with different size</span></span><br><span class="line">fig = plt.figure(figsize=(<span class="hljs-number">7</span>,<span class="hljs-number">4</span>))</span><br><span class="line"><span class="hljs-comment">##definitions for the axes</span></span><br><span class="line">left, width = <span class="hljs-number">0.07</span>, <span class="hljs-number">0.6</span></span><br><span class="line">bottom, height = <span class="hljs-number">0.1</span>, <span class="hljs-number">.8</span></span><br><span class="line">bottom_h = left_h = left+width+<span class="hljs-number">0.05</span></span><br><span class="line">rect_cones = [left, bottom, width, height]</span><br><span class="line">rect_box = [left_h, bottom, <span class="hljs-number">0.5</span>, height]</span><br><span class="line">ax1 = plt.axes(rect_cones,projection=ccrs.PlateCarree())</span><br><span class="line">ax2 = plt.axes(rect_box)</span><br><span class="line">ax2.set_aspect(get_aspect(ax1) / get_aspect(ax2))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#12. fake circle legend</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">plot_legend</span>(<span class="hljs-params">title</span>):</span><br><span class="line">    s = [<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">7</span>,<span class="hljs-number">9</span>]</span><br><span class="line">    c = plt.cm.binary(np.arange(<span class="hljs-number">5</span>)/<span class="hljs-number">5.0</span>)</span><br><span class="line">    labels =[<span class="hljs-string">'A'</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">'C'</span>,<span class="hljs-string">"D"</span>,<span class="hljs-string">"E"</span>]</span><br><span class="line">    cir1 =  plt.scatter([<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], c=c[<span class="hljs-number">0</span>], alpha=<span class="hljs-number">0.8</span>, s=s[<span class="hljs-number">0</span>],label=<span class="hljs-string">r'&lt;0.5'</span>)</span><br><span class="line">    cir2 =  plt.scatter([<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], c=c[<span class="hljs-number">1</span>], alpha=<span class="hljs-number">0.8</span>, s=s[<span class="hljs-number">1</span>],label=labels[<span class="hljs-number">1</span>])</span><br><span class="line">    cir3 =  plt.scatter([<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], c=c[<span class="hljs-number">2</span>], alpha=<span class="hljs-number">0.8</span>, s=s[<span class="hljs-number">2</span>],label=labels[<span class="hljs-number">2</span>])</span><br><span class="line">    cir4 =  plt.scatter([<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], c=c[<span class="hljs-number">3</span>], alpha=<span class="hljs-number">0.8</span>, s=s[<span class="hljs-number">3</span>],label=labels[<span class="hljs-number">3</span>])</span><br><span class="line">    cir5 =  plt.scatter([<span class="hljs-number">1</span>], [<span class="hljs-number">2</span>], c=c[<span class="hljs-number">4</span>], alpha=<span class="hljs-number">0.8</span>, s=s[<span class="hljs-number">4</span>],label=labels[<span class="hljs-number">4</span>])    </span><br><span class="line">    leg = plt.legend([cir1,cir2,cir3,cir4,cir5],labels,scatterpoints = <span class="hljs-number">1</span>,  \</span><br><span class="line">                     frameon=<span class="hljs-literal">False</span>, labelspacing=<span class="hljs-number">0.9</span>, ncol =<span class="hljs-number">2</span>,</span><br><span class="line">                     fontsize=<span class="hljs-number">8</span>,title=title , loc = [<span class="hljs-number">0.05</span>,<span class="hljs-number">0.1</span>])   </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#13. seperated colors from colormap</span></span><br><span class="line">c_list = plt.cm.rainbow(np.arange(<span class="hljs-number">6</span>)/<span class="hljs-number">6.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 14. set twin axis with different color</span></span><br><span class="line">axu = ax.twinx()</span><br><span class="line">axu.spines[<span class="hljs-string">"right"</span>].set_position((<span class="hljs-string">"axes"</span>, <span class="hljs-number">1.25</span>))</span><br><span class="line">so_,=plt.plot(xxx)</span><br><span class="line">axu.yaxis.label.set_color(so_.get_color())</span><br><span class="line">axu.spines[<span class="hljs-string">'right'</span>].set_color(so_.get_color())</span><br><span class="line">axu.spines[<span class="hljs-string">"right"</span>].set_edgecolor(so_.get_color())</span><br><span class="line">axu.tick_params(axis=<span class="hljs-string">'y'</span>, colors=so_.get_color())</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 15. add a rectangle</span></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib.patches <span class="hljs-keyword">import</span> Rectangle</span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.patches <span class="hljs-keyword">as</span> mpatches</span><br><span class="line">rec = mpatches.Rectangle((position[i]-</span><br><span class="line">                    width/<span class="hljs-number">2.0</span>,bot_[i]),width,hei_[i],linewidth=<span class="hljs-number">1</span>,edgecolor=<span class="hljs-string">'b'</span>,facecolor=<span class="hljs-string">'none'</span>,zorder=<span class="hljs-number">12</span>)</span><br><span class="line">    ax.add_patch(rec)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 16. output the color by pre-defined alpha</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">make_rgb_transparent</span>(<span class="hljs-params">rgb, bg_rgb, alpha</span>):</span><br><span class="line">    <span class="hljs-keyword">return</span> [alpha * c1 + (<span class="hljs-number">1</span> - alpha) * c2</span><br><span class="line">            <span class="hljs-keyword">for</span> (c1, c2) <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(rgb, bg_rgb)]</span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> colors</span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">alpha = <span class="hljs-number">0.5</span></span><br><span class="line"></span><br><span class="line">kwargs = <span class="hljs-built_in">dict</span>(edgecolors=<span class="hljs-string">'none'</span>, s=<span class="hljs-number">3900</span>, marker=<span class="hljs-string">'s'</span>)</span><br><span class="line"><span class="hljs-keyword">for</span> i, color <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>([<span class="hljs-string">'red'</span>, <span class="hljs-string">'blue'</span>, <span class="hljs-string">'green'</span>]):</span><br><span class="line">    rgb = colors.colorConverter.to_rgb(color)</span><br><span class="line">    rgb_new = make_rgb_transparent(rgb, (<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>), alpha)</span><br><span class="line">    <span class="hljs-built_in">print</span>(color, rgb, rgb_new)</span><br><span class="line">    plt.scatter([i], [<span class="hljs-number">0</span>], color=color, **kwargs)</span><br><span class="line">    plt.scatter([i], [<span class="hljs-number">1</span>], color=color, alpha=alpha, **kwargs)</span><br><span class="line">    plt.scatter([i], [<span class="hljs-number">2</span>], color=rgb_new, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 17. terrain map</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">truncate_colormap</span>(<span class="hljs-params">cmap, minval=<span class="hljs-number">0.0</span>, maxval=<span class="hljs-number">1.0</span>, n=<span class="hljs-number">100</span></span>):</span><br><span class="line">    new_cmap = colors.LinearSegmentedColormap.from_list(</span><br><span class="line">    <span class="hljs-string">'trunc({n},{a:.2f},{b:.2f})'</span>.<span class="hljs-built_in">format</span>(n=cmap.name, a=minval, b=maxval),</span><br><span class="line">    cmap(np.linspace(minval, maxval, n)))</span><br><span class="line">    <span class="hljs-keyword">return</span> new_cmap</span><br><span class="line">cmap = plt.get_cmap(<span class="hljs-string">'terrain'</span>)</span><br><span class="line">terrain_cmap = truncate_colormap(cmap, <span class="hljs-number">0.15</span>, <span class="hljs-number">0.9</span>)  </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 18. 不等距subplots</span></span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.gridspec <span class="hljs-keyword">as</span> gridspec</span><br><span class="line">fig = plt.figure(figsize=(<span class="hljs-number">9</span>,<span class="hljs-number">6</span>))</span><br><span class="line">gs = gridspec.GridSpec(<span class="hljs-number">46</span>,<span class="hljs-number">1</span>)</span><br><span class="line">row_xx = <span class="hljs-number">23</span></span><br><span class="line"><span class="hljs-comment"># pm25_pm10</span></span><br><span class="line">ax1 = plt.subplot(gs[<span class="hljs-number">0</span>:row_xx, <span class="hljs-number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 19. two axis one legend</span></span><br><span class="line"><span class="hljs-comment"># ask matplotlib for the plotted objects and their labels</span></span><br><span class="line">lines, labels = ax.get_legend_handles_labels()</span><br><span class="line">lines2, labels2 = ax2.get_legend_handles_labels()</span><br><span class="line">ax2.legend(lines + lines2, labels + labels2, loc=<span class="hljs-number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 20. Cartopy longitude</span></span><br><span class="line"><span class="hljs-comment">## 方法1</span></span><br><span class="line">ax.set_xticks([<span class="hljs-number">0</span>, <span class="hljs-number">60</span>, <span class="hljs-number">120</span>, <span class="hljs-number">180</span>, <span class="hljs-number">240</span>, <span class="hljs-number">300</span>, <span class="hljs-number">360</span>], crs=ccrs.PlateCarree())d</span><br><span class="line">ax.set_yticks([-<span class="hljs-number">90</span>, -<span class="hljs-number">60</span>, -<span class="hljs-number">30</span>, <span class="hljs-number">0</span>, <span class="hljs-number">30</span>, <span class="hljs-number">60</span>, <span class="hljs-number">90</span>], crs=ccrs.PlateCarree())</span><br><span class="line">lon_formatter = LongitudeFormatter(zero_direction_label=<span class="hljs-literal">True</span>)</span><br><span class="line">lat_formatter = LatitudeFormatter()</span><br><span class="line">ax.xaxis.set_major_formatter(lon_formatter)</span><br><span class="line">ax.yaxis.set_major_formatter(lat_formatter)</span><br><span class="line"><span class="hljs-comment">## 方法2</span></span><br><span class="line">ax.set_xticks(np.arange(extent[<span class="hljs-number">0</span>]+<span class="hljs-number">2</span>, extent[<span class="hljs-number">1</span>]+<span class="hljs-number">2</span>, <span class="hljs-number">15</span>), crs=ccrs.PlateCarree())</span><br><span class="line">ax.set_yticks(np.arange(extent[<span class="hljs-number">2</span>]+<span class="hljs-number">3</span>, extent[<span class="hljs-number">3</span>], <span class="hljs-number">15</span>), crs=ccrs.PlateCarree())</span><br><span class="line">ax.set_xticklabels([<span class="hljs-string">r'$\mathrm{75^o E}$'</span>,<span class="hljs-string">r'$\mathrm{90^o E}$'</span>,<span class="hljs-string">r'$\mathrm{105^o E}$'</span>,\</span><br><span class="line">                    <span class="hljs-string">r'$\mathrm{120^o E}$'</span>,<span class="hljs-string">r'$\mathrm{135^o E}$'</span>,])</span><br><span class="line">ax.set_yticklabels([<span class="hljs-string">r'$\mathrm{20^o N}$'</span>,<span class="hljs-string">r'$\mathrm{35^o N}$'</span>,<span class="hljs-string">r'$\mathrm{50^o N}$'</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 21 'GeoAxesSubplot' object has no attribute '_hold'</span></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib.axes <span class="hljs-keyword">import</span> Axes</span><br><span class="line"><span class="hljs-keyword">from</span> cartopy.mpl.geoaxes <span class="hljs-keyword">import</span> GeoAxes</span><br><span class="line">GeoAxes._pcolormesh_patched = Axes.pcolormesh</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 22.中英文混排</span></span><br><span class="line"><span class="hljs-comment"># # -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt</span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib.font_manager <span class="hljs-keyword">import</span> FontProperties</span><br><span class="line"></span><br><span class="line">song_ti = FontProperties(fname=<span class="hljs-string">r'/Library/Fonts/Songti.ttc'</span>, size=<span class="hljs-number">20</span>)</span><br><span class="line">times_new_roman = FontProperties(fname=<span class="hljs-string">r'/Library/Fonts/Arial Black.ttf'</span>, size=<span class="hljs-number">15</span>)</span><br><span class="line">ax = plt.gca()</span><br><span class="line">ax.set_title(<span class="hljs-string">u'能量随时间的变化'</span>, fontproperties=song_ti)</span><br><span class="line">ax.set_xlabel(<span class="hljs-string">'Time (s)'</span>, fontproperties=times_new_roman)</span><br><span class="line">ax.set_ylabel(<span class="hljs-string">'Energy (J)'</span>, fontproperties=times_new_roman)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 23. no-legend</span></span><br><span class="line">(label=<span class="hljs-string">'_nolegend_'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 25. plot with grey background</span></span><br><span class="line">ax.set_facecolor(<span class="hljs-string">"#F5F5F5"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 26. Midpoint-normalized</span></span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.colors <span class="hljs-keyword">as</span> colors</span><br><span class="line"><span class="hljs-comment">#https://stackoverflow.com/questions/25500541/matplotlib-bwr-colormap-always-centered-on-zero</span></span><br><span class="line"><span class="hljs-keyword">class</span> <span class="title class_">MidpointNormalize</span>(colors.Normalize):</span><br><span class="line">    <span class="hljs-keyword">def</span> <span class="title function_">__init__</span>(<span class="hljs-params">self, vmin=<span class="hljs-literal">None</span>, vmax=<span class="hljs-literal">None</span>, midpoint=<span class="hljs-literal">None</span>, clip=<span class="hljs-literal">False</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.midpoint = midpoint</span><br><span class="line">        colors.Normalize.__init__(<span class="variable language_">self</span>, vmin, vmax, clip)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">def</span> <span class="title function_">__call__</span>(<span class="hljs-params">self, value, clip=<span class="hljs-literal">None</span></span>):</span><br><span class="line">        <span class="hljs-comment"># I'm ignoring masked values and all kinds of edge cases to make a</span></span><br><span class="line">        <span class="hljs-comment"># simple example...</span></span><br><span class="line">        x, y = [<span class="variable language_">self</span>.vmin, <span class="variable language_">self</span>.midpoint, <span class="variable language_">self</span>.vmax], [<span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">1</span>]</span><br><span class="line">        <span class="hljs-keyword">return</span> np.ma.masked_array(np.interp(value, x, y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 27. 月份colorbar</span></span><br><span class="line">cbaxes = fig.add_axes([<span class="hljs-number">0.29</span>, <span class="hljs-number">0.27</span>, <span class="hljs-number">0.18</span>, <span class="hljs-number">0.02</span>]) </span><br><span class="line">cbar = plt.colorbar(ss,cax=cbaxes, orientation=<span class="hljs-string">'horizontal'</span>)</span><br><span class="line">n = <span class="hljs-number">6</span></span><br><span class="line">st_po = []</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,n,<span class="hljs-number">1</span>):</span><br><span class="line">    st_po.append(np.array_split(pd.to_datetime(<span class="hljs-built_in">sorted</span>(date_point)),n)[i].values[<span class="hljs-number">0</span>])</span><br><span class="line">cb_ticks = [<span class="hljs-built_in">float</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> st_po]</span><br><span class="line">cbar.ax.set_xticklabels(pd.to_datetime(cb_ticks).strftime(<span class="hljs-string">'%b'</span>)) <span class="hljs-comment">#B     </span></span><br><span class="line">cbar.ax.tick_params(labelsize=<span class="hljs-number">8.5</span>)  </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 28. nclcmaps</span></span><br><span class="line"><span class="hljs-keyword">import</span> nclcmaps</span><br><span class="line">nclcmaps.cmaps(<span class="hljs-string">"precip2_17lev"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 29. 创建新的colormap</span></span><br><span class="line"> cm = LinearSegmentedColormap.from_list(<span class="hljs-string">'test'</span>,plt.cm.BuPu(np.arange(<span class="hljs-number">6</span>)/<span class="hljs-number">6.0</span>)[<span class="hljs-number">1</span>:], N=<span class="hljs-number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="hljs-comment"># 30. 最好的terrain map</span></span><br><span class="line">http://chris35wills.github.io/discrete_colourbar/</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 31. 对数坐标系统显示实际数值</span></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib.ticker <span class="hljs-keyword">import</span> StrMethodFormatter, NullFormatter</span><br><span class="line">ax.yaxis.set_major_formatter(StrMethodFormatter(<span class="hljs-string">'{x:.3f}'</span>))</span><br><span class="line">ax.yaxis.set_minor_formatter(NullFormatter())  </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 32. loop figure for subplot</span></span><br><span class="line">fig, axs = plt.subplots(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>, figsize=(<span class="hljs-number">15</span>, <span class="hljs-number">6</span>), facecolor=<span class="hljs-string">'w'</span>, edgecolor=<span class="hljs-string">'k'</span>)<span class="hljs-comment">#subplot_kw={'projection': ccrs.PlateCarree()}</span></span><br><span class="line">fig.subplots_adjust(hspace = <span class="hljs-number">.5</span>, wspace=<span class="hljs-number">.001</span>)</span><br><span class="line">axs = axs.ravel()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">8</span>):</span><br><span class="line"></span><br><span class="line">    axs[i].contourf(np.random.rand(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>),<span class="hljs-number">5</span>,cmap=plt.cm.Oranges)</span><br><span class="line">    axs[i].set_title(<span class="hljs-built_in">str</span>(<span class="hljs-number">250</span>+i))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># patch_box  </span></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib.collections <span class="hljs-keyword">import</span> PatchCollection</span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib.patches <span class="hljs-keyword">import</span> Rectangle</span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">PATCH_BOX</span>(<span class="hljs-params">ax,pos,wid</span>):</span><br><span class="line">    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> pos[::<span class="hljs-number">2</span>]:</span><br><span class="line">        width = wid/<span class="hljs-number">2.0</span></span><br><span class="line">        facecolor = <span class="hljs-string">"#F0F0F0"</span> </span><br><span class="line">        rect = Rectangle((x-width, <span class="hljs-number">0.00</span>), width*<span class="hljs-number">4.0</span>,<span class="hljs-number">1000000</span>,facecolor=facecolor,linewidth = <span class="hljs-number">0</span>)<span class="hljs-comment">#           clip_on=False,</span></span><br><span class="line">        ax.add_patch(rect)     </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 33. cartopy extent 报错问题</span></span><br><span class="line">https://github.com/SciTools/cartopy/issues/<span class="hljs-number">837</span></span><br><span class="line">pip uninstall shapely &amp;&amp; pip install --no-binary :<span class="hljs-built_in">all</span>: shapely</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 34. shapely的向量化总是报错</span></span><br><span class="line"><span class="hljs-comment"># https://github.com/Toblerity/Shapely/issues/810</span></span><br><span class="line">pip uninstall shapely &amp; pip install shapely --no-binary shapely==<span class="hljs-number">1.7</span>a2</span><br><span class="line"></span><br><span class="line"> <span class="hljs-comment"># 35. scatter图的外环</span></span><br><span class="line">linewidths=<span class="hljs-number">1</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 36. discrete color from continuous colormap</span></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> cm</span><br><span class="line">cs=cm.Set2(np.arange(<span class="hljs-number">4</span>)/<span class="hljs-number">4.</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 36. how to plot circle on unequal axes </span></span><br><span class="line">ax.plot(<span class="hljs-number">0.3</span>,-<span class="hljs-number">0.1</span> , <span class="hljs-string">'ro'</span>, fillstyle=<span class="hljs-string">'full'</span>, markersize=<span class="hljs-number">5</span>, transform=ax.transAxes,clip_on =<span class="hljs-literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 37. Plotting multi-polygons with pre-defined color lists.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 38. Plotting scatter pl</span></span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib.dates <span class="hljs-keyword">as</span> mdates</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Method</span></span><br><span class="line"><span class="hljs-comment"># In method 1, the color for each data point is determined by the date value in date_point. The date values are converted to numerical values using mdates.date2num() before passing to ax.scatter(). The colorbar ticks and labels are set using mdates.AutoDateLocator() and mdates.ConciseDateFormatter(). 1</span></span><br><span class="line">fig1 = plt.figure(figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>))</span><br><span class="line">ax1 = fig1.add_subplot()</span><br><span class="line"></span><br><span class="line">date_point = df[<span class="hljs-string">'Date'</span>]</span><br><span class="line">ss1 = ax1.scatter(df[<span class="hljs-string">'WSOC'</span>], df[<span class="hljs-string">'OC'</span>], c=mdates.date2num(date_point), cmap=plt.cm.coolwarm, s=<span class="hljs-number">100</span>)</span><br><span class="line">cbaxes1 = fig1.add_axes([<span class="hljs-number">0.29</span>, <span class="hljs-number">0.27</span>, <span class="hljs-number">0.48</span>, <span class="hljs-number">0.02</span>]) </span><br><span class="line">cb1 = plt.colorbar(ss1, cax=cbaxes1, orientation=<span class="hljs-string">'horizontal'</span>)</span><br><span class="line">loc1 = mdates.AutoDateLocator(maxticks=<span class="hljs-number">12</span>)</span><br><span class="line">cb1.ax.xaxis.set_major_locator(loc1)</span><br><span class="line">cb1.ax.xaxis.set_major_formatter(mdates.ConciseDateFormatter(loc1))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Method 2</span></span><br><span class="line"><span class="hljs-comment"># Method 2 uses the datetime values directly as color values, which means the colorbar ticks will match the dates exactly. It manually divides the range of dates into 5 segments and creates tick labels with the abbreviated month names.</span></span><br><span class="line">fig2 = plt.figure(figsize=(<span class="hljs-number">5</span>, <span class="hljs-number">5</span>))</span><br><span class="line">ax2 = fig2.add_subplot()</span><br><span class="line"></span><br><span class="line">date_point = df[<span class="hljs-string">'Date'</span>]</span><br><span class="line">ss2 = ax2.scatter(df[<span class="hljs-string">'WSOC'</span>], df[<span class="hljs-string">'OC'</span>], c=date_point, cmap=plt.cm.coolwarm, s=<span class="hljs-number">100</span>)</span><br><span class="line"></span><br><span class="line">cbaxes2 = fig2.add_axes([<span class="hljs-number">0.29</span>, <span class="hljs-number">0.27</span>, <span class="hljs-number">0.48</span>, <span class="hljs-number">0.02</span>]) </span><br><span class="line">cbar2 = plt.colorbar(ss2, cax=cbaxes2, orientation=<span class="hljs-string">'horizontal'</span>)</span><br><span class="line"></span><br><span class="line">n = <span class="hljs-number">5</span></span><br><span class="line">st_po = []</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, n, <span class="hljs-number">1</span>):</span><br><span class="line">    st_po.append(np.array_split(pd.to_datetime(<span class="hljs-built_in">sorted</span>(date_point)), n)[i].values[<span class="hljs-number">0</span>])</span><br><span class="line"></span><br><span class="line">cb_ticks = [<span class="hljs-built_in">float</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> st_po]</span><br><span class="line">cbar2.ax.set_xticklabels(pd.to_datetime(cb_ticks).strftime(<span class="hljs-string">'%b'</span>)) <span class="hljs-comment">#B     </span></span><br><span class="line">cbar2.ax.tick_params(labelsize=<span class="hljs-number">8.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#39. plotting color palette based on user-defined color list</span></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib.colors <span class="hljs-keyword">import</span> ListedColormap</span><br><span class="line"><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl</span><br><span class="line"></span><br><span class="line">fig = plt.subplots(figsize=(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>))</span><br><span class="line">ax = plt.subplot(<span class="hljs-number">111</span>)</span><br><span class="line">color_list = [<span class="hljs-string">'#cccccc'</span>, <span class="hljs-string">'#da6701'</span>,<span class="hljs-string">'#00994d'</span>,<span class="hljs-string">'#00cccc'</span>, <span class="hljs-string">'#0000ff'</span>,<span class="hljs-string">'#000099'</span>,<span class="hljs-string">'#c9ace6'</span>,<span class="hljs-string">'#9039e6'</span>,<span class="hljs-string">'#000000'</span>]</span><br><span class="line">cmap_diy = ListedColormap(color_list, color_list)</span><br><span class="line">col_map = cmap_diy</span><br><span class="line">new_val = []</span><br><span class="line">ticks = np.linspace(<span class="hljs-number">0.0</span>,<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(color_list)+<span class="hljs-number">1</span>)</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(ticks)-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>):</span><br><span class="line">    new_val.append((ticks[i]+ticks[i+<span class="hljs-number">1</span>])/<span class="hljs-number">2.0</span>)</span><br><span class="line">cbar  = mpl.colorbar.ColorbarBase(ax, cmap=col_map, orientation = <span class="hljs-string">'horizontal'</span>, ticks =new_val, alpha = <span class="hljs-number">0.75</span>)</span><br><span class="line">cbar.ax.set_xticklabels(color_list, fontsize =<span class="hljs-number">12</span>, rotation = <span class="hljs-number">30</span>) </span><br><span class="line">ttl = plt.title(<span class="hljs-string">'EESI Color Palette 1'</span>,fontweight=<span class="hljs-string">"bold"</span>,fontsize =<span class="hljs-number">18</span>,)</span><br><span class="line">ttl.set_position([<span class="hljs-number">.5</span>, <span class="hljs-number">1.15</span>])</span><br><span class="line">plt.tight_layout()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#40. Boxplot</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">box_plot</span>(<span class="hljs-params">ax, data, pos, color</span>):</span><br><span class="line">    bp = ax.boxplot(data, sym=<span class="hljs-string">''</span>, whis=[<span class="hljs-number">5</span>, <span class="hljs-number">95</span>], widths=(<span class="hljs-built_in">len</span>(data) + <span class="hljs-number">4</span>) / (<span class="hljs-number">2</span> * <span class="hljs-built_in">len</span>(data)) * <span class="hljs-number">0.7</span>, positions=pos, </span><br><span class="line">                    boxprops=<span class="hljs-built_in">dict</span>(facecolor=color, edgecolor=color), medianprops=<span class="hljs-built_in">dict</span>(color=<span class="hljs-string">'k'</span>), </span><br><span class="line">                    whiskerprops=<span class="hljs-built_in">dict</span>(color=<span class="hljs-string">'k'</span>), capprops=<span class="hljs-built_in">dict</span>(color=<span class="hljs-string">'k'</span>), patch_artist=<span class="hljs-literal">True</span>)</span><br><span class="line">    <span class="hljs-keyword">for</span> box <span class="hljs-keyword">in</span> bp[<span class="hljs-string">'boxes'</span>]:</span><br><span class="line">        box.<span class="hljs-built_in">set</span>(facecolor=color)</span><br><span class="line">    <span class="hljs-keyword">return</span> bp</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#41. Linear fitting in short</span></span><br><span class="line"><span class="hljs-comment"># Remove NaN values from the data</span></span><br><span class="line"><span class="hljs-keyword">import</span> stats</span><br><span class="line">mask = ~np.isnan(x) &amp; ~np.isnan(y)</span><br><span class="line">x_clean = x[mask]</span><br><span class="line">y_clean = y[mask]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Perform linear regression and calculate the slope and intercept</span></span><br><span class="line">slope, intercept, r_value, p_value, std_err = stats.linregress(x_clean, y_clean)</span><br><span class="line"><span class="hljs-comment"># Create a scatter plot with error bars using matplotlib</span></span><br><span class="line">fig, ax = plt.subplots()</span><br><span class="line">ax.scatter(x_clean, y_clean, s=<span class="hljs-number">50</span>, edgecolors=<span class="hljs-string">'black'</span>, alpha=<span class="hljs-number">0.8</span>)</span><br><span class="line"><span class="hljs-comment"># Add the linear fit line</span></span><br><span class="line">ax.plot(x_clean, slope*x_clean + intercept, color=<span class="hljs-string">'red'</span>, linestyle=<span class="hljs-string">'-'</span>, label=<span class="hljs-string">'Linear Fit'</span>)</span><br><span class="line"><span class="hljs-comment"># Annotate the fitted equation</span></span><br><span class="line">ax.text(<span class="hljs-number">0.05</span>, <span class="hljs-number">0.95</span>, <span class="hljs-string">'y = {:.2f}x + {:.2f}'</span>.<span class="hljs-built_in">format</span>(slope, intercept), transform=ax.transAxes, fontsize=<span class="hljs-number">14</span>,horizontalalignment=<span class="hljs-string">'left'</span>,\ verticalalignment=<span class="hljs-string">'top'</span>, bbox=<span class="hljs-built_in">dict</span>(facecolor=<span class="hljs-string">'white'</span>,edgecolor=<span class="hljs-string">'white'</span>, alpha=<span class="hljs-number">0.8</span>))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#42. Color-coded with dates</span></span><br><span class="line">fig  = plt.figure(figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">4</span>))</span><br><span class="line">c_time   = mdates.date2num(auto_df_dl[<span class="hljs-string">'Date'</span>])</span><br><span class="line">ss       = plt.scatter(pd.to_datetime(auto_df_dl[<span class="hljs-string">'sample_starting_time'</span>]), auto_df_dl[<span class="hljs-string">'130.15903'</span>], c=c_time,cmap = plt.cm.Spectral_r)</span><br><span class="line">cbaxes = fig.add_axes([<span class="hljs-number">0.61</span>, <span class="hljs-number">0.75</span>, <span class="hljs-number">0.25</span>,<span class="hljs-number">0.02</span>]) </span><br><span class="line">cb = plt.colorbar(ss, cax=cbaxes, orientation=<span class="hljs-string">'horizontal'</span>)</span><br><span class="line">loc = mdates.AutoDateLocator(maxticks=<span class="hljs-number">12</span>)</span><br><span class="line">cb.ax.xaxis.set_major_locator(loc)</span><br><span class="line">cb.ax.xaxis.set_major_formatter(mdates.ConciseDateFormatter(loc))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 43. Add tooltips to the scatter plots</span></span><br><span class="line">labels = [<span class="hljs-string">"%.2f"</span> % (c) + tof_ion[i] <span class="hljs-keyword">for</span> i, c <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(tof_mz.values)]</span><br><span class="line">tooltip = mpld3.plugins.PointLabelTooltip(ax.collections, labels=labels)</span><br><span class="line">mpld3.plugins.connect(fig, tooltip)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 44. Horizontial and vertical color bar</span></span><br><span class="line">cbaxes = fig.add_axes([<span class="hljs-number">0.775</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.11</span>, <span class="hljs-number">0.015</span>]) </span><br><span class="line">ticks = [<span class="hljs-number">50</span>,<span class="hljs-number">100</span>, <span class="hljs-number">250</span>,<span class="hljs-number">500</span>] </span><br><span class="line">cbar = plt.colorbar(ss_,ticks =ticks, cax=cbaxes,orientation=<span class="hljs-string">'horizontal'</span>, )</span><br><span class="line">cbar.ax.set_xticks(ticks) <span class="hljs-comment"># set the tick locations</span></span><br><span class="line">cbar.ax.set_xticklabels(tick_labels, fontsize=<span class="hljs-number">7</span>) <span class="hljs-comment"># set the tick labels</span></span><br><span class="line">cbar.ax.set_xlabel(<span class="hljs-string">'FRP (MW)'</span>,fontsize = <span class="hljs-number">8</span>, labelpad = -<span class="hljs-number">25</span>)</span><br><span class="line">cbar.ax.tick_params(color=<span class="hljs-string">'#FFFFFF'</span>, direction=<span class="hljs-string">'in'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 45. Dendragram</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">plot_matrix_dendrogram_cn</span>(<span class="hljs-params">corr_,va</span>):</span><br><span class="line">    D = corr_</span><br><span class="line">    ax1 = fig.add_axes([<span class="hljs-number">0.9</span>,<span class="hljs-number">0.15</span>,<span class="hljs-number">0.11</span>,<span class="hljs-number">0.7</span>*<span class="hljs-number">7</span>/<span class="hljs-number">6.0</span>])</span><br><span class="line">    Y = sch.linkage(D, method=<span class="hljs-string">'ward'</span>) <span class="hljs-comment">#method='centroid')ward</span></span><br><span class="line">    set_link_color_palette(line_color)</span><br><span class="line">    <span class="hljs-comment"># Temporarily override the default line width:</span></span><br><span class="line">    <span class="hljs-keyword">with</span> plt.rc_context({<span class="hljs-string">'lines.linewidth'</span>: <span class="hljs-number">1.25</span>}):</span><br><span class="line">        Z1 = sch.dendrogram(Y, orientation=<span class="hljs-string">'right'</span>,above_threshold_color=<span class="hljs-string">'grey'</span>, color_threshold=va,</span><br><span class="line">                           )</span><br><span class="line">    ax1.set_xticks([])</span><br><span class="line">    ax1.set_yticks([])</span><br><span class="line">    ax1.axis(<span class="hljs-string">'off'</span>)</span><br><span class="line">    </span><br><span class="line">    axmatrix = fig.add_axes([<span class="hljs-number">0.05</span>,<span class="hljs-number">0.15</span>,<span class="hljs-number">0.70</span>,<span class="hljs-number">0.7</span>*<span class="hljs-number">7</span>/<span class="hljs-number">6.0</span>])</span><br><span class="line">    idx1 = Z1[<span class="hljs-string">'leaves'</span>]</span><br><span class="line">    idx2 = Z1[<span class="hljs-string">'leaves'</span>]</span><br><span class="line">    D = D[idx1,:]</span><br><span class="line">    D = D[:,idx1]</span><br><span class="line">    mask =  np.tri(D.shape[<span class="hljs-number">1</span>], k=-<span class="hljs-number">1</span>)</span><br><span class="line">    A = np.ma.array(D, mask=mask)</span><br><span class="line">    cmap =  plt.cm.YlOrRd</span><br><span class="line"><span class="hljs-comment">#     cmap = cm.get_cmap('YlGnBu') #YlOrRd</span></span><br><span class="line">    cmap.set_over(<span class="hljs-string">'#C0C1C0'</span>)</span><br><span class="line">    im = axmatrix.matshow(A, aspect=<span class="hljs-string">'auto'</span>, origin=<span class="hljs-string">'lower'</span>, cmap=cmap,vmax = <span class="hljs-number">0.999</span>, )<span class="hljs-comment">#Spectral_r</span></span><br><span class="line"><span class="hljs-comment">#     im = axmatrix.pcolormesh(A, cmap=cmap,vmax = 0.999, edgecolors ='grey',lw = 0.0)#Spectral_r    </span></span><br><span class="line"><span class="hljs-comment">#     axmatrix.set_xticks(range(len(ele_name))-0.5)</span></span><br><span class="line">    axmatrix.set_xticks(np.arange(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(ele_name),<span class="hljs-number">1</span>) - <span class="hljs-number">0.5</span>)</span><br><span class="line">    site_X = [ele_name[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> idx1]</span><br><span class="line">    axmatrix.set_xticklabels(site_X, minor=<span class="hljs-literal">False</span>, va=<span class="hljs-string">"baseline"</span>)</span><br><span class="line">    axmatrix.xaxis.set_label_position(<span class="hljs-string">'bottom'</span>)</span><br><span class="line">    axmatrix.xaxis.tick_bottom()</span><br><span class="line">    pylab.xticks(fontsize=<span class="hljs-number">8</span>,)</span><br><span class="line">    axmatrix.tick_params(axis=<span class="hljs-string">'x'</span>, pad=<span class="hljs-number">60</span>,length=<span class="hljs-number">0</span>,rotation = <span class="hljs-number">45</span>)</span><br><span class="line">    axmatrix.tick_params(axis=<span class="hljs-string">'y'</span>, pad=<span class="hljs-number">2</span>,length=<span class="hljs-number">0</span>)    </span><br><span class="line"></span><br><span class="line">    ind_array = np.arange(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(ele_name),<span class="hljs-number">1</span>)</span><br><span class="line">    x, y = np.meshgrid(ind_array, ind_array)</span><br><span class="line">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(ele_name),<span class="hljs-number">1</span>):</span><br><span class="line">        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(ele_name),<span class="hljs-number">1</span>):</span><br><span class="line">            <span class="hljs-keyword">if</span> math.isnan(A[j,i]) == <span class="hljs-number">0</span>:</span><br><span class="line">                axmatrix.text(i, j, <span class="hljs-built_in">str</span>(<span class="hljs-built_in">round</span>(A[j,i], <span class="hljs-number">2</span>)), color = <span class="hljs-string">'black'</span>,va=<span class="hljs-string">'center'</span>, ha=<span class="hljs-string">'center'</span>, fontsize = <span class="hljs-number">12</span>)</span><br><span class="line"></span><br><span class="line">    axcolor = fig.add_axes([<span class="hljs-number">0.05</span>,<span class="hljs-number">0.7</span>,<span class="hljs-number">0.2</span>,<span class="hljs-number">0.015</span>])</span><br><span class="line">    cbar = pylab.colorbar(im, cax=axcolor,orientation=<span class="hljs-string">'horizontal'</span> )</span><br><span class="line">    cbar.set_label(<span class="hljs-string">r'$\mathregular{{Pearson^{\prime}}s\ r}$'</span>, labelpad = -<span class="hljs-number">35</span>, fontsize = <span class="hljs-number">10</span>)    </span><br><span class="line">    loc_ = np.array([<span class="hljs-number">0.2</span>,<span class="hljs-number">0.5</span>,<span class="hljs-number">0.8</span>])</span><br><span class="line">    cbar.set_ticks(loc_)</span><br><span class="line">    ttt = [<span class="hljs-number">0.2</span>,<span class="hljs-number">0.5</span>,<span class="hljs-number">0.8</span>]</span><br><span class="line">    cbar.set_ticklabels(ttt,)</span><br><span class="line">    cbar.ax.tick_params(color=<span class="hljs-string">"w"</span>, direction=<span class="hljs-string">'in'</span>,labelsize=<span class="hljs-number">10</span>)<span class="hljs-comment"># length</span></span><br><span class="line"></span><br><span class="line">    axmatrix.set_yticks(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(ele_name)))</span><br><span class="line">    site_Y = [ ele_name[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> idx1]</span><br><span class="line">    axmatrix.set_yticklabels(site_Y, minor=<span class="hljs-literal">False</span>, fontsize =<span class="hljs-number">8</span>)</span><br><span class="line">    axmatrix.yaxis.set_label_position(<span class="hljs-string">'right'</span>)</span><br><span class="line">    axmatrix.yaxis.tick_right()</span><br><span class="line">    pylab.yticks( fontsize=<span class="hljs-number">8</span>)</span><br><span class="line">    axmatrix.spines[<span class="hljs-string">'left'</span>].set_visible(<span class="hljs-literal">False</span>)</span><br><span class="line">    axmatrix .spines[<span class="hljs-string">'top'</span>].set_visible(<span class="hljs-literal">False</span>)  </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">fitting_line</span>(<span class="hljs-params">x,y</span>):</span><br><span class="line">    mask = ~np.isnan(x) &amp; ~np.isnan(y)</span><br><span class="line">    x_clean = x[mask]</span><br><span class="line">    y_clean = y[mask]</span><br><span class="line"></span><br><span class="line">    slope, intercept, r_value, p_value, std_err = stats.linregress(x_clean, y_clean)</span><br><span class="line">    annotation = <span class="hljs-string">f"y = <span class="hljs-subst">{slope:<span class="hljs-number">.2</span>f}</span>x + <span class="hljs-subst">{intercept:<span class="hljs-number">.2</span>f}</span>\n\n"</span> + <span class="hljs-string">f"r = <span class="hljs-subst">{r_value:<span class="hljs-number">.2</span>f}</span>"</span></span><br><span class="line">    ax.annotate(annotation, xy=(<span class="hljs-number">0.05</span>, <span class="hljs-number">0.7</span>), xycoords=<span class="hljs-string">'axes fraction'</span>, fontsize = <span class="hljs-number">10</span>)</span><br><span class="line">    <span class="hljs-comment"># the version without slope</span></span><br><span class="line">    <span class="hljs-comment"># x_clean = x_clean[:,np.newaxis]</span></span><br><span class="line">    <span class="hljs-comment"># a, _, _, _ = np.linalg.lstsq(x_clean, y_clean)</span></span><br><span class="line">    <span class="hljs-comment"># print (a,)</span></span><br><span class="line">    <span class="hljs-comment"># annotation = f"y = {a[0]:.2f}x"</span></span><br><span class="line">    <span class="hljs-comment"># ax.annotate(annotation, xy=(0.15, 0.7), xycoords='axes fraction', fontsize = 10)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## 46. Venn plot for 2 elements</span></span><br><span class="line">list_a,list_b =  owb_poa,owb_soa</span><br><span class="line">ions_intersection      = list_a[list_a[<span class="hljs-string">'Ion'</span>].isin(list_b[<span class="hljs-string">'Ion'</span>])][<span class="hljs-string">'Ion'</span>].unique()</span><br><span class="line">ions_only_a            = list_a[~list_a[<span class="hljs-string">'Ion'</span>].isin(list_b[<span class="hljs-string">'Ion'</span>])][<span class="hljs-string">'Ion'</span>].unique()</span><br><span class="line">ions_only_b           =  list_b[~list_b[<span class="hljs-string">'Ion'</span>].isin(list_a[<span class="hljs-string">'Ion'</span>])][<span class="hljs-string">'Ion'</span>].unique()</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib_venn <span class="hljs-keyword">import</span> venn2</span><br><span class="line"><span class="hljs-comment"># Determine the counts</span></span><br><span class="line">num_ions_in_a_not_b  = <span class="hljs-built_in">len</span>(ions_only_a)</span><br><span class="line">num_ions_in_b_not_a = <span class="hljs-built_in">len</span>(ions_only_b)</span><br><span class="line">num_ions_intersection = <span class="hljs-built_in">len</span>(ions_intersection)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Plot Venn Diagram</span></span><br><span class="line">plt.figure(figsize=(<span class="hljs-number">6</span>, <span class="hljs-number">5</span>))</span><br><span class="line">venn2(subsets=(num_ions_in_a_not_b,num_ions_in_b_not_a, num_ions_intersection), </span><br><span class="line">      set_labels=(<span class="hljs-string">'Open wood burning POA'</span>,<span class="hljs-string">'Open wood burning SOA'</span>),</span><br><span class="line">     set_colors=(<span class="hljs-string">'#5477b1'</span>, <span class="hljs-string">'#f5a34f'</span>))</span><br><span class="line"><span class="hljs-comment"># plt.title("Orbitrap peak list")</span></span><br><span class="line">plt.savefig(<span class="hljs-string">'./Figures/20240423/Orbitrap_fitted_ions_OWB_POA+SOA.png'</span>, dpi = <span class="hljs-number">400</span>)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## 47. Venn plot for 3 elements</span></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">only_in_target</span>(<span class="hljs-params">tar,ref1,ref2</span>):</span><br><span class="line">    list1= (tar[tar[<span class="hljs-string">'Ion'</span>].isin(ref1[<span class="hljs-string">'Ion'</span>])][<span class="hljs-string">'Ion'</span>].unique())</span><br><span class="line">    list2= (tar[tar[<span class="hljs-string">'Ion'</span>].isin(ref2[<span class="hljs-string">'Ion'</span>])][<span class="hljs-string">'Ion'</span>].unique())</span><br><span class="line">    </span><br><span class="line">    list_tot = np.unique(np.append(list1,list2))</span><br><span class="line">    <span class="hljs-keyword">return</span> tar[~tar[<span class="hljs-string">'Ion'</span>].isin(list_tot)][<span class="hljs-string">'Ion'</span>].unique()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Calculate intersections</span></span><br><span class="line">ions_intersection_ab = list_a[list_a[<span class="hljs-string">'Ion'</span>].isin(list_b[<span class="hljs-string">'Ion'</span>])][<span class="hljs-string">'Ion'</span>].unique()</span><br><span class="line">ions_intersection_ac = list_a[list_a[<span class="hljs-string">'Ion'</span>].isin(list_c[<span class="hljs-string">'Ion'</span>])][<span class="hljs-string">'Ion'</span>].unique()</span><br><span class="line">ions_intersection_bc = list_b[list_b[<span class="hljs-string">'Ion'</span>].isin(list_c[<span class="hljs-string">'Ion'</span>])][<span class="hljs-string">'Ion'</span>].unique()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Intersection of all three lists</span></span><br><span class="line">ions_intersection_abc = list_a[list_a[<span class="hljs-string">'Ion'</span>].isin(ions_intersection_bc)][<span class="hljs-string">'Ion'</span>].unique()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Calculate unique ions</span></span><br><span class="line">ions_only_a = only_in_target(list_a,list_b,list_c)</span><br><span class="line">ions_only_b = only_in_target(list_b,list_a,list_c)</span><br><span class="line">ions_only_c = only_in_target(list_c,list_a,list_b)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Unique in a, b and c but not in the intersection of all three</span></span><br><span class="line">ions_unique_a = np.setdiff1d(ions_only_a, ions_intersection_abc)</span><br><span class="line">ions_unique_b = np.setdiff1d(ions_only_b, ions_intersection_abc)</span><br><span class="line">ions_unique_c = np.setdiff1d(ions_only_c, ions_intersection_abc)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Calculate lengths</span></span><br><span class="line">num_ions_in_a_not_bc = <span class="hljs-built_in">len</span>(ions_unique_a)</span><br><span class="line">num_ions_in_b_not_ac = <span class="hljs-built_in">len</span>(ions_unique_b)</span><br><span class="line">num_ions_in_c_not_ab = <span class="hljs-built_in">len</span>(ions_unique_c)</span><br><span class="line">num_ions_intersection_ab = <span class="hljs-built_in">len</span>(ions_intersection_ab) - <span class="hljs-built_in">len</span>(ions_intersection_abc)</span><br><span class="line">num_ions_intersection_ac = <span class="hljs-built_in">len</span>(ions_intersection_ac) - <span class="hljs-built_in">len</span>(ions_intersection_abc)</span><br><span class="line">num_ions_intersection_bc = <span class="hljs-built_in">len</span>(ions_intersection_bc) - <span class="hljs-built_in">len</span>(ions_intersection_abc)</span><br><span class="line">num_ions_intersection_abc = <span class="hljs-built_in">len</span>(ions_intersection_abc)</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> matplotlib_venn <span class="hljs-keyword">import</span> venn3</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))</span><br><span class="line">v = venn3(subsets=(num_ions_in_a_not_bc, num_ions_in_b_not_ac, num_ions_intersection_ab,</span><br><span class="line">                   num_ions_in_c_not_ab, num_ions_intersection_ac, num_ions_intersection_bc, num_ions_intersection_abc),</span><br><span class="line">     set_colors=(<span class="hljs-string">'#a6cee3'</span>, <span class="hljs-string">'#d83f3f'</span>, <span class="hljs-string">'#405f3a'</span>),      </span><br><span class="line">      set_labels=(<span class="hljs-string">'All samples Merged (2371 ions)'</span>, <span class="hljs-string">'     Coal burning SOA (616 ions)'</span>, <span class="hljs-string">'                                                    Open burning SOA (858 ions)'</span>))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># change the edgecolor to black</span></span><br><span class="line"><span class="hljs-keyword">for</span> area <span class="hljs-keyword">in</span> v.patches:</span><br><span class="line">    <span class="hljs-keyword">if</span> area:</span><br><span class="line">        area.set_edgecolor(<span class="hljs-string">'k'</span>)</span><br><span class="line"></span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.savefig(<span class="hljs-string">"./Figures/20240423/Combined_coal_POA_owb_SOA_All.png"</span>, dpi = <span class="hljs-number">400</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="4-Jupyter-and-Python-setting"><a href="#4-Jupyter-and-Python-setting" class="headerlink" title=" 4. Jupyter and Python setting  "></a><font color="blue"> 4. Jupyter and Python setting  </font></h2><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#1. Full width displaying all the time</span></span><br><span class="line"><span class="hljs-keyword">from</span> IPython.core.display <span class="hljs-keyword">import</span> display, HTML</span><br><span class="line">display(HTML(<span class="hljs-string">"&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;"</span>))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#2. Import script.py files</span></span><br><span class="line"><span class="hljs-keyword">import</span> os,sys</span><br><span class="line">scriptpath = <span class="hljs-string">"/Users/HYF/Downloads/stackoverflow_tag_cloud-master/"</span></span><br><span class="line"><span class="hljs-comment">##Add the directory containing your module to the Python path (wants absolute paths)</span></span><br><span class="line">sys.path.append(os.path.abspath(scriptpath))</span><br><span class="line"><span class="hljs-comment">## Do the import</span></span><br><span class="line"><span class="hljs-keyword">import</span> stackoverflow_users_taginfo</span><br><span class="line"><span class="hljs-keyword">from</span> stackoverflow_users_taginfo <span class="hljs-keyword">import</span> taginfo</span><br><span class="line">info = taginfo(link = <span class="hljs-number">4918632</span>, num_tags = <span class="hljs-number">400</span>)</span><br><span class="line">WordCloud().generate_from_frequencies(info).to_image().save(<span class="hljs-string">'TagCloud.pdf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#3. Check the installing path</span></span><br><span class="line"><span class="hljs-keyword">import</span> time</span><br><span class="line">time.file</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#4. Get the pathname of the file</span></span><br><span class="line">script_dir = os.path.dirname(os.path.realpath(filename)) + os.sep             </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#5. Change the size of the uploaded figure</span></span><br><span class="line">&lt;img src=<span class="hljs-string">"https://i.stack.imgur.com/kK1LC.png"</span> width=<span class="hljs-string">"100"</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#6. Inquire the information of computer, Python and its package using watermark package</span></span><br><span class="line">pip install watermark</span><br><span class="line">%load_ext watermark </span><br><span class="line"><span class="hljs-comment">## Compiler, system, and CPU</span></span><br><span class="line">%watermark </span><br><span class="line"><span class="hljs-comment">## numpy version</span></span><br><span class="line">%watermark -p numpy</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 7. 取消Warnings显示</span></span><br><span class="line"><span class="hljs-keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="hljs-string">'ignore'</span>)</span><br></pre></td></tr></tbody></table></figure>

<h2 id="5-Some-tex-characters"><a href="#5-Some-tex-characters" class="headerlink" title="&nbsp;5. Some tex characters  "></a><font color="blue">&nbsp;5. Some tex characters  </font></h2><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\leq  &lt;</span><br></pre></td></tr></tbody></table></figure>

<h2 id="6-Spatial-analysis"><a href="#6-Spatial-analysis" class="headerlink" title="6. Spatial analysis  "></a><font color="blue">6. Spatial analysis  </font></h2><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 1. intersection of two lines</span></span><br><span class="line"><span class="hljs-keyword">import</span> fiona</span><br><span class="line"><span class="hljs-keyword">from</span> shapely.geometry <span class="hljs-keyword">import</span> shape</span><br><span class="line"><span class="hljs-keyword">from</span> shapely.geometry <span class="hljs-keyword">import</span> LineString</span><br><span class="line">line1 = fiona.<span class="hljs-built_in">open</span>(fname)<span class="hljs-comment"># fname is the path to a specific polyline-format shapefile.</span></span><br><span class="line">line1 = shape(line1.<span class="hljs-built_in">next</span>()[<span class="hljs-string">'geometry'</span>]) </span><br><span class="line">start_point, end_point = (<span class="hljs-number">111</span>,<span class="hljs-number">22</span>),(<span class="hljs-number">33</span>,<span class="hljs-number">33</span>)</span><br><span class="line">line2 = LineString([start_point, end_point])</span><br><span class="line"><span class="hljs-built_in">print</span> line1.intersection(line2)</span><br><span class="line"><span class="hljs-built_in">print</span> line1.intersection(line2).is_empty</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 2. Read .tif</span></span><br><span class="line"><span class="hljs-keyword">import</span> warnings</span><br><span class="line"><span class="hljs-keyword">import</span> rasterio</span><br><span class="line">warnings.filterwarnings(<span class="hljs-string">'ignore'</span>)</span><br><span class="line"><span class="hljs-keyword">import</span> skimage.transform <span class="hljs-keyword">as</span> st </span><br><span class="line">pathToRaster  =<span class="hljs-string">r'/Users/HYF/Downloads/2014/per2014/中国年均降水.tif'</span></span><br><span class="line">xs = np.array([<span class="hljs-number">100.5</span>, <span class="hljs-number">12.0</span>])</span><br><span class="line">ys = np.array([<span class="hljs-number">2.5</span>, <span class="hljs-number">42.0</span>])</span><br><span class="line"><span class="hljs-comment"># src.bounds</span></span><br><span class="line"><span class="hljs-keyword">with</span> rasterio.<span class="hljs-built_in">open</span>(pathToRaster) <span class="hljs-keyword">as</span> src:</span><br><span class="line">    arr = src.read()</span><br><span class="line">    arr[arr&lt;<span class="hljs-number">0</span>] = np.nan</span><br><span class="line">    arr = arr[<span class="hljs-number">0</span>,:,:]</span><br><span class="line">    rows, cols = rasterio.transform.rowcol(src.transform, xs, ys)    </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 3. mask point series</span></span><br><span class="line">mask_= []</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(df_fire_cn),<span class="hljs-number">1</span>):</span><br><span class="line">    xy_point = gpd.geoseries.Point(df_fire_cn.lon.iloc[i],df_fire_cn.lat.iloc[i])</span><br><span class="line">    res = geom.contains(xy_point)</span><br><span class="line">    mask_.append(res)</span><br><span class="line">df_fire_cn = df_fire_cn[mask_]    </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 4. Classify scatter point based on polylines</span></span><br><span class="line"><span class="hljs-keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="hljs-string">'ignore'</span>)</span><br><span class="line"><span class="hljs-keyword">from</span> shapely.geometry <span class="hljs-keyword">import</span> shape</span><br><span class="line"><span class="hljs-keyword">from</span> shapely.geometry <span class="hljs-keyword">import</span> LineString</span><br><span class="line"><span class="hljs-comment"># loading the boundary layer</span></span><br><span class="line"><span class="hljs-keyword">import</span> fiona</span><br><span class="line">fname = <span class="hljs-string">'/Users/HYF/Dropbox/data/geo/中国地图/供暖分界/N-S_boundary.shp'</span></span><br><span class="line">line1 = fiona.<span class="hljs-built_in">open</span>(fname)</span><br><span class="line">line1 = shape(line1.<span class="hljs-built_in">next</span>()[<span class="hljs-string">'geometry'</span>]) </span><br><span class="line"><span class="hljs-comment"># set a end point which is the southernmost for all stations. </span></span><br><span class="line">end_point  = (dy[dy[<span class="hljs-string">'lat'</span>]==dy[<span class="hljs-string">'lat'</span>].<span class="hljs-built_in">min</span>()][<span class="hljs-string">'lon'</span>].values[<span class="hljs-number">0</span>],dy[dy[<span class="hljs-string">'lat'</span>]==dy[<span class="hljs-string">'lat'</span>].<span class="hljs-built_in">min</span>()][<span class="hljs-string">'lat'</span>].values[<span class="hljs-number">0</span>])</span><br><span class="line"><span class="hljs-comment"># loop all monitoring stations for classification</span></span><br><span class="line">dy[<span class="hljs-string">'NS'</span>]= np.nan</span><br><span class="line"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(dy),<span class="hljs-number">1</span>):</span><br><span class="line">    start_point = (dy[<span class="hljs-string">'lon'</span>].iloc[i],dy[<span class="hljs-string">'lat'</span>].iloc[i])</span><br><span class="line">    line2       = LineString([start_point, end_point])</span><br><span class="line">    <span class="hljs-keyword">if</span> line1.intersection(line2).is_empty:</span><br><span class="line">        dy[<span class="hljs-string">"NS"</span>].iloc[i]=<span class="hljs-string">'S'</span></span><br><span class="line">    <span class="hljs-keyword">else</span>:</span><br><span class="line">        dy[<span class="hljs-string">"NS"</span>].iloc[i]=<span class="hljs-string">'N'</span>        </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 5. transform shp file to geojson</span></span><br><span class="line"><span class="hljs-keyword">import</span> fiona</span><br><span class="line"><span class="hljs-keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Open the shapefile using fiona</span></span><br><span class="line"><span class="hljs-keyword">with</span> fiona.<span class="hljs-built_in">open</span>(<span class="hljs-string">"shapefile.shp"</span>) <span class="hljs-keyword">as</span> src:</span><br><span class="line">    <span class="hljs-comment"># Create a new GeoJSON file</span></span><br><span class="line">    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"shapefile.geojson"</span>, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> output:</span><br><span class="line">        <span class="hljs-comment"># Write the GeoJSON representation of the shapefile to the file</span></span><br><span class="line">        output.write(json.dumps(<span class="hljs-built_in">list</span>(src)))</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># referencing https://gist.github.com/pelson/9785576</span></span><br><span class="line"><span class="hljs-keyword">import</span> fiona</span><br><span class="line"><span class="hljs-keyword">import</span> shapely.vectorized</span><br><span class="line"><span class="hljs-keyword">from</span> shapely.geometry <span class="hljs-keyword">import</span> shape</span><br><span class="line">fname = <span class="hljs-string">r'xxx/china.shp'</span></span><br><span class="line">cn_area = fiona.<span class="hljs-built_in">open</span>(fname)</span><br><span class="line">pol = cn_area.<span class="hljs-built_in">next</span>()</span><br><span class="line">geom = shape(pol[<span class="hljs-string">'geometry'</span>])</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## four corner </span></span><br><span class="line">x0,x1 = geom.bounds[<span class="hljs-number">0</span>],geom.bounds[<span class="hljs-number">2</span>]</span><br><span class="line">y0,y1 = geom.bounds[<span class="hljs-number">1</span>],geom.bounds[<span class="hljs-number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## creating the mask array</span></span><br><span class="line"></span><br><span class="line">x  = np.linspace(x0,x1,<span class="hljs-number">30</span>)</span><br><span class="line">y  = np.linspace(y0,y1,<span class="hljs-number">20</span>)</span><br><span class="line">xx,yy = np.meshgrid(x,y)</span><br><span class="line"><span class="hljs-keyword">import</span> time</span><br><span class="line">start = time.time()</span><br><span class="line">mask_ = shapely.vectorized.contains(geom,  xx,yy)</span><br><span class="line"><span class="hljs-built_in">print</span> <span class="hljs-string">"Process time: "</span> + <span class="hljs-built_in">str</span>(time.time() - start)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## 出现错误:  'Polygon' object is not iterable      </span></span><br><span class="line">shapeFeature([c.geometry])    </span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># when nothing showed up in Plotly </span></span><br><span class="line"><span class="hljs-keyword">import</span> plotly.io <span class="hljs-keyword">as</span> pio</span><br><span class="line">pio.renderers.default = <span class="hljs-string">"notebook"</span>  <span class="hljs-comment"># or "jupyterlab"</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="7-Other-functions"><a href="#7-Other-functions" class="headerlink" title="7. Other functions  "></a><font color="blue">7. Other functions  </font></h2><figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"># 1.Crop PDF file</span></span><br><span class="line"><span class="hljs-comment"># https://pypi.org/project/pdfcropper/#files</span></span><br><span class="line">pdf-crop-margins -v -s -u /Users/HYF/Dropbox/thesis//5_全国时空分析/output/Sec3/As_空间差异图.pdf</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># 2. When the self-installed files were unable to be imported</span></span><br><span class="line">python setup.py build</span><br><span class="line">python setup.py install</span><br><span class="line"><span class="hljs-comment">## Then, install the package and egg into</span></span><br><span class="line">&gt;/Users/HYF/anaconda3/lib/python3<span class="hljs-number">.7</span>/site-packages</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#3. Enabling code folding in Jupyter lab</span></span><br><span class="line">setting/notebook</span><br><span class="line">{</span><br><span class="line"> <span class="hljs-string">"codeCellConfig"</span>: {</span><br><span class="line"> <span class="hljs-string">"codeFolding"</span>: true</span><br><span class="line"> }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">#4. How to search for content in any notebook on local PC by keywords</span></span><br><span class="line"><span class="hljs-keyword">import</span> glob</span><br><span class="line">pattern = <span class="hljs-string">'./../../../../**/*.ipynb'</span></span><br><span class="line">query = <span class="hljs-string">'EESI_inforamtion_example'</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> filepath <span class="hljs-keyword">in</span> glob.iglob(pattern, recursive=<span class="hljs-literal">True</span>):</span><br><span class="line">    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath) <span class="hljs-keyword">as</span> file:</span><br><span class="line">        s = file.read()</span><br><span class="line">        <span class="hljs-keyword">if</span> (s.find(query) &gt; -<span class="hljs-number">1</span>):</span><br><span class="line">            <span class="hljs-built_in">print</span>(filepath)</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="hljs-comment"># 5. pandas function for reading markdown table</span></span><br><span class="line"><span class="hljs-comment"># Paste in your table and assign it to a variable</span></span><br><span class="line">md_table_string = <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">| Risk Factor | Estimated Annual Number of Deaths |</span></span><br><span class="line"><span class="hljs-string">|---|---|</span></span><br><span class="line"><span class="hljs-string">| Air pollution (outdoor &amp; indoor) | 1,670,000 |</span></span><br><span class="line"><span class="hljs-string">| High blood pressure | 1,470,000 |</span></span><br><span class="line"><span class="hljs-string">| High blood sugar | 1,120,000 |</span></span><br><span class="line"><span class="hljs-string">| Smoking | 1,010,000 |</span></span><br><span class="line"><span class="hljs-string">| Outdoor particulate matter pollution | 979,682 |</span></span><br><span class="line"><span class="hljs-string">| Indoor air pollution | 630,093 |</span></span><br><span class="line"><span class="hljs-string">| Obesity | 606,890 |</span></span><br><span class="line"><span class="hljs-string">| Unsafe water source | 508,290 |</span></span><br><span class="line"><span class="hljs-string">| Low birth weight | 579,108 |</span></span><br><span class="line"><span class="hljs-string">| Alcohol use | 343,695 |</span></span><br><span class="line"><span class="hljs-string">| Unsafe sanitation | 258,257 |</span></span><br><span class="line"><span class="hljs-string">| Diet low in whole grains | 256,232 |</span></span><br><span class="line"><span class="hljs-string">| Diet low in fruits | 240,098 |</span></span><br><span class="line"><span class="hljs-string">| Secondhand smoke | 174,797 |</span></span><br><span class="line"><span class="hljs-string">| Diet high in sodium | 173,939 |</span></span><br><span class="line"><span class="hljs-string">| No access to handwashing facility | 164,172 |</span></span><br><span class="line"><span class="hljs-string">| Diet low in nuts and seeds | 134,007 |</span></span><br><span class="line"><span class="hljs-string">| Diet low in vegetables | 118,682 |</span></span><br><span class="line"><span class="hljs-string">| Low bone mineral density | 118,283 |</span></span><br><span class="line"><span class="hljs-string">| Low physical activity | 96,012 |</span></span><br><span class="line"><span class="hljs-string">| Drug use | 72,903 |</span></span><br><span class="line"><span class="hljs-string">| Child stunting | 17,973 |</span></span><br><span class="line"><span class="hljs-string">| Iron deficiency | 10,098 |</span></span><br><span class="line"><span class="hljs-string">| Non-exclusive breastfeeding | 1,501 |</span></span><br><span class="line"><span class="hljs-string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> StringIO</span><br><span class="line">death_factor = pd.read_csv(</span><br><span class="line">    StringIO(md_table_string.replace(<span class="hljs-string">' '</span>, <span class="hljs-string">''</span>)),  <span class="hljs-comment"># Get rid of whitespaces</span></span><br><span class="line">    sep=<span class="hljs-string">'|'</span>,</span><br><span class="line">    index_col=<span class="hljs-number">1</span></span><br><span class="line">).dropna(</span><br><span class="line">    axis=<span class="hljs-number">1</span>,</span><br><span class="line">    how=<span class="hljs-string">'all'</span></span><br><span class="line">).iloc[<span class="hljs-number">1</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## mount the external drive</span></span><br><span class="line">sudo umount /mnt/n</span><br><span class="line">sudo mount -t drvfs -o metadata,uid=<span class="hljs-number">1000</span>,gid=<span class="hljs-number">1000</span> N: /mnt/n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">## unzip all files within the folder</span></span><br><span class="line"><span class="hljs-comment">#!/bin/bash   \# Navigate to the directory containing the zip files </span></span><br><span class="line">cd /path/to/your/directory </span><br><span class="line"><span class="hljs-comment"># Loop through all files with .z* extensions and unzip them   </span></span><br><span class="line"><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-number">248650.</span>z*; do</span><br><span class="line">    echo <span class="hljs-string">"Unzipping $file..."</span> </span><br><span class="line">    unzip <span class="hljs-string">"$file"</span> -d ./unzip/ \<span class="hljs-comment"># Unzip to a subdirectory called 'unzipped_files'   </span></span><br><span class="line">done    </span><br><span class="line">echo <span class="hljs-string">"All files have been unzipped."</span></span><br></pre></td></tr></tbody></table></figure></body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Python/">#Python</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Visualization/">#Visualization</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2018/08/10/10.%5BModel%5DFLEXPART_INSTALLATION_NOTE/">FLEXPART installation notes</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2018/04/04/8.%5BDataset%5DChina%20air%20quality%20data%20in%20HDF5%20format/">中国空气质量历史数据整理(HDF5格式)</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">댓글</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'http://envhyf.github.io/2018/07/22/9.[Code]Useful%20python%20scripts%20for%20daily%20use/';
        this.page.identifier = '2018/07/22/9.[Code]Useful python scripts for daily use/';
        
        this.language = 'zh';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'taipingta' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2025 Hao Yufang&nbsp;
                Разработано на базе <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" target="_blank" rel="noopener" href="https://github.com/envhyf/">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery > p > .gallery-item').unwrap();
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="아무거나 입력하세요" />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '글',
                PAGES: '페이지',
                CATEGORIES: '카테고리 목록',
                TAGS: '태그 목록',
                UNTITLED: '(제목없음)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>
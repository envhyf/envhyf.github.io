<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>From Formula to Structure: Inferring Compound Class from MS1 + MS2 - 太平塔</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">








    <meta name="description" content="With ultra-high resolution Orbitrap MS1 scan, I already obtain highly accurate chemical formulae. However, chemical information are still not enough.       First, each formula may correspond to multip">
<meta property="og:type" content="article">
<meta property="og:title" content="From Formula to Structure: Inferring Compound Class from MS1 + MS2">
<meta property="og:url" content="http://envhyf.github.io/2025/04/01/41.[MS]From_Formula_to%20Function_Inferring_Compound_Class_from_MS1+MS2/index.html">
<meta property="og:site_name" content="太平塔">
<meta property="og:description" content="With ultra-high resolution Orbitrap MS1 scan, I already obtain highly accurate chemical formulae. However, chemical information are still not enough.       First, each formula may correspond to multip">
<meta property="og:locale">
<meta property="og:image" content="http://envhyf.github.io/images/MS2/Fig.bad_example_of_no_meaningful_MS2.png">
<meta property="og:image" content="http://envhyf.github.io/images/MS2/Fig.MSBuddy.png">
<meta property="og:image" content="http://envhyf.github.io/images/MS2/Fig.SIRIUS_paper.png">
<meta property="og:image" content="http://envhyf.github.io/images/MS2/Fig.Results_from_SIRIUS.png">
<meta property="article:published_time" content="2025-04-01T13:40:00.000Z">
<meta property="article:modified_time" content="2025-08-07T21:59:41.047Z">
<meta property="article:author" content="Hao Yufang">
<meta property="article:tag" content="Orbitrap">
<meta property="article:tag" content="Mass Spectrometry">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://envhyf.github.io/images/MS2/Fig.bad_example_of_no_meaningful_MS2.png">





<link rel="icon" href="/bugcatcher.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css">


<link rel="stylesheet" href="/css/style.css">


<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116955364-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-116955364-1');
</script>


    


<meta name="generator" content="Hexo 6.1.0"></head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    太平塔
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/categories/Research">Research</a>
            
            <a class="navbar-item "
               href="/categories/Tech">Tech</a>
            
            <a class="navbar-item "
               href="/categories/Life">Life</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            From Formula to Structure: Inferring Compound Class from MS1 + MS2
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            
                <time datetime="2025-04-01T13:40:00.000Z" itemprop="datePublished">4月 1 2025</time>
            
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/Research/">Research</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            15 分钟 read (About 2317 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><p>With ultra-high resolution Orbitrap MS1 scan, I already obtain highly accurate chemical formulae. However, chemical information are still not enough.      </p>
<p>First, each formula may correspond to multiple isomeric structures, and each isomer can carry unique information,such as its special emitters, formation pathways, or toxicity. </p>
<p>Even worse, some ions share nearly identical m/z values under the fitting threshold (20 ppm tolerance)but correspond to entirely different molecular formule.   </p>
<span id="more"></span>   

<figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m/z 261.12288 → C14H17N2O3  ↔  C12H18N2NaO3  </span><br><span class="line">m/z 262.15073 → C12H21N3NaO2  ↔  C9H20N5O4  </span><br><span class="line">m/z 263.10217 → C13H15N2O4  ↔  C11H16N2NaO4  </span><br></pre></td></tr></tbody></table></figure>

<p>If we apply MS²  analysis, we can go beyond the limitations of MS1. In this process, a specific parent ion is first isolated in the quadrupole. Only this ion (actually also co-isolated ions in the same window) is allowed to pass through to the next stage, where it enters the collision cell and collide with N2 gas.</p>
<p>The resulting fragment ions, which carry structural information about the parent ion, are then introduced into the Orbitrap for high-resolution detection. These fragments provide rich m/z information, often linked to the presence or loss of specific functional groups, making the spectrum highly informative.</p>
<p>By analyzing these MS2 spectra, either through in silico computational tools or by matching against curated spectral libraries, we can narrow down the structural identity of the parent ion. This capability is not only just valuable in environmental science but also has broad and profound applications in other fields. For example, in medical research, it is widely used for the structural identification of metabolites, disease diagnostics biomarker discovery (<a target="_blank" rel="noopener" href="https://polarishub.io/competitions/asap-discovery/antiviral-drug-discovery-2025">an interesting link</a>). In food chemistry, it enables the profiling of bioactive compounds and nutritional components.</p>
<h2 id="1-MS2-strategy-knowledge-base"><a href="#1-MS2-strategy-knowledge-base" class="headerlink" title="1. MS2 strategy knowledge base"></a>1. MS2 strategy knowledge base</h2><p>Generally, there are two types of MS² (tandem mass spectrometry) acquisition strategies that can be adopted:</p>
<ol>
<li><p>DDA – Data-Dependent Acquisition<br>In this approach, precursor ions are selected based on the MS1 signal intensity. The instrument automatically selects the top N most intense precursor ions (above a certain threshold) for fragmentation in MS2 (MS/MS).    </p>
<p>✅ Advantage: High-abundance ions usually yield high-quality MS2 spectra, making structural interpretation more reliable.<br>⚠️ Limitation: Low-abundance ions may be missed, which is especially problematic in environmental samples like mine, where many of the most intense signals originate from background contaminants rather than meaningful analytes.</p>
</li>
<li><p>DIA – Data-Independent Acquisition<br>In DIA, all ions within predefined m/z windows are fragmented simultaneously, regardless of their intensity.        </p>
<p>✅ Advantage: Provides broader MS2 coverage, ensuring that even low-abundance compounds are captured.<br>⚠️ Limitation: The resulting MS2 spectra are highly complex and often require advanced deconvolution algorithms to interpret.</p>
</li>
</ol>
<p>In my case, I will first work with MS1 full-scan mode, using post-acquisition data analysis to identify and narrow down a list of important precursor ions across different m/z windows. Based on this information, I will then apply a targeted Selected Ion Monitoring (SIM) method focused on these specific ions. For each target, I will optimize key acquisition parameters with the goal of obtaining reproducible, stable, and chemically meaningful fragment patterns for downstream structural interpretation.</p>
<p>From the paper of Assress et al (2023), I summarize the important paramters used for MS2 DIA analysis</p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Description &amp; Role</strong></th>
<th><strong>Tuning Range</strong></th>
<th><strong>Optimal Setting</strong></th>
<th><strong>Notes</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>MS2 Resolution</strong></td>
<td>For MS/MS spectra quality</td>
<td>30k–120k</td>
<td><strong>30k</strong></td>
<td>Higher resolution MS/MS = fewer scans due to slower cycle</td>
</tr>
<tr>
<td><strong>RF Lens (%)</strong></td>
<td>Focuses ions before analysis</td>
<td>10–100%</td>
<td><strong>70%</strong></td>
<td>Balance between signal intensity and ion transmission</td>
</tr>
<tr>
<td><strong>Mass Isolation Width</strong></td>
<td>m/z window for selecting precursors</td>
<td>0.4–6.0</td>
<td><strong>2.0 m/z</strong></td>
<td>Narrow windows increase purity but reduce sensitivity</td>
</tr>
<tr>
<td><strong>Intensity Threshold</strong></td>
<td>Min signal to trigger MS/MS</td>
<td>1e3–1e8</td>
<td><strong>1e4</strong></td>
<td>Lower thresholds = more spectra, but lower quality</td>
</tr>
<tr>
<td><strong>TopN</strong> (MS/MS Events)</td>
<td>Max MS/MS per cycle</td>
<td>5–20</td>
<td><strong>Top 10</strong></td>
<td>More MS/MS = more compounds, but slower scans</td>
</tr>
<tr>
<td><strong>Cycle Time</strong> (s)</td>
<td>Max time per scan loop</td>
<td>1–7 s</td>
<td><strong>1 s</strong></td>
<td>Shorter = better chromatographic peak sampling</td>
</tr>
<tr>
<td><strong>AGC Target</strong></td>
<td>Target ion count (MS/MS)</td>
<td>50–500%</td>
<td><strong>100%</strong></td>
<td>Prevents overfilling or low ion count</td>
</tr>
<tr>
<td><strong>MIT (MS2)</strong> (ms)</td>
<td>For MS/MS scans</td>
<td>50–300 ms</td>
<td><strong>50 ms</strong></td>
<td>Longer MIT slows scan speed</td>
</tr>
<tr>
<td><strong>Microscans</strong></td>
<td>Number of averaged scans</td>
<td>1–10</td>
<td><strong>1</strong></td>
<td>Higher = better S/N, but much slower cycle</td>
</tr>
<tr>
<td><strong>Collision Energy</strong></td>
<td>For ion fragmentation</td>
<td>Fixed/Stepped</td>
<td><strong>Stepped: 10 &amp; 40 V</strong></td>
<td>Stepped energies improve MS/MS spectrum richness</td>
</tr>
<tr>
<td><strong>Dynamic Exclusion</strong></td>
<td>Prevents redundant fragmentation</td>
<td>3–100 s</td>
<td><strong>10 s</strong></td>
<td>Ensures broader MS/MS coverage</td>
</tr>
</tbody></table>
<h2 id="3-Simple-MS2-Level-Data-Visualization"><a href="#3-Simple-MS2-Level-Data-Visualization" class="headerlink" title="3. Simple MS2-Level Data Visualization"></a>3. Simple MS2-Level Data Visualization</h2><p>This section presents a basic workflow for parsing and visualizing MS1 and MS2 data exported from Orbitrap. The raw <code>.raw</code> files are first converted into <code>.ms1</code> and <code>.ms2</code> formats using tools such as <strong>MZmine3</strong> or <strong>RawConverter</strong>.</p>
<p>Two functions are provided as follows:</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">ms1_segment_scan_read</span>(<span class="hljs-params">file_path</span>):</span><br><span class="line">    </span><br><span class="line">    segments = []  <span class="hljs-comment"># To store data for each segment</span></span><br><span class="line">    current_segment = <span class="hljs-literal">None</span>  <span class="hljs-comment"># To store data for the current segment</span></span><br><span class="line">    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:</span><br><span class="line">        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:</span><br><span class="line">            line = line.strip()  <span class="hljs-comment"># Remove leading/trailing whitespace</span></span><br><span class="line">            <span class="hljs-keyword">if</span> line.startswith(<span class="hljs-string">"S"</span>):  <span class="hljs-comment"># Start of a new segment</span></span><br><span class="line">                <span class="hljs-keyword">if</span> current_segment <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:</span><br><span class="line">                    <span class="hljs-comment"># Save the current segment data</span></span><br><span class="line">                    segments.append(current_segment)</span><br><span class="line">                current_segment = {</span><br><span class="line">                    <span class="hljs-string">'scan'</span>: <span class="hljs-literal">None</span>,</span><br><span class="line">                    <span class="hljs-string">'RetTime'</span>: <span class="hljs-literal">None</span>,</span><br><span class="line">                    <span class="hljs-string">'IonInjectionTime'</span>: <span class="hljs-literal">None</span>,</span><br><span class="line">                    <span class="hljs-string">'InstrumentType'</span>: <span class="hljs-literal">None</span>,</span><br><span class="line">                    <span class="hljs-string">'data'</span>: []  <span class="hljs-comment"># To store m/z, S/N, charge, Intensity</span></span><br><span class="line">                }</span><br><span class="line">                </span><br><span class="line">                parts = line.split()</span><br><span class="line">                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt;= <span class="hljs-number">2</span>:</span><br><span class="line">                    current_segment[<span class="hljs-string">'scan'</span>] = <span class="hljs-built_in">int</span>(parts[<span class="hljs-number">1</span>])</span><br><span class="line">            <span class="hljs-keyword">elif</span> line.startswith(<span class="hljs-string">"I"</span>):  <span class="hljs-comment"># Metadata line</span></span><br><span class="line">                parts = line.split()</span><br><span class="line">                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt;= <span class="hljs-number">3</span>:</span><br><span class="line">                    key = parts[<span class="hljs-number">1</span>]</span><br><span class="line">                    value = parts[<span class="hljs-number">2</span>]</span><br><span class="line">                    <span class="hljs-keyword">if</span> key == <span class="hljs-string">'RetTime'</span>:</span><br><span class="line">                        current_segment[<span class="hljs-string">'RetTime'</span>] = <span class="hljs-built_in">float</span>(value)</span><br><span class="line">                    <span class="hljs-keyword">elif</span> key == <span class="hljs-string">'IonInjectionTime'</span>:</span><br><span class="line">                        current_segment[<span class="hljs-string">'IonInjectionTime'</span>] = <span class="hljs-built_in">float</span>(value)</span><br><span class="line">                    <span class="hljs-keyword">elif</span> key == <span class="hljs-string">'InstrumentType'</span>:</span><br><span class="line">                        current_segment[<span class="hljs-string">'InstrumentType'</span>] = value</span><br><span class="line">            <span class="hljs-keyword">elif</span> line <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> line.startswith((<span class="hljs-string">"H"</span>, <span class="hljs-string">"I"</span>, <span class="hljs-string">"S"</span>)):  <span class="hljs-comment"># Data line</span></span><br><span class="line">                parts = line.split()</span><br><span class="line">                <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) == <span class="hljs-number">4</span>:  <span class="hljs-comment"># Ensure the line has m/z, S/N, charge, Intensity</span></span><br><span class="line">                    mz = <span class="hljs-built_in">float</span>(parts[<span class="hljs-number">0</span>])</span><br><span class="line">                    intensity = <span class="hljs-built_in">float</span>(parts[<span class="hljs-number">1</span>])</span><br><span class="line">                    current_segment[<span class="hljs-string">'data'</span>].append([mz, intensity])</span><br><span class="line">        <span class="hljs-keyword">if</span> current_segment <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:</span><br><span class="line">            segments.append(current_segment)</span><br><span class="line">    data_list = []</span><br><span class="line">    <span class="hljs-keyword">for</span> segment <span class="hljs-keyword">in</span> segments:</span><br><span class="line">        scan = segment[<span class="hljs-string">'scan'</span>]</span><br><span class="line">        ret_time = segment[<span class="hljs-string">'RetTime'</span>]</span><br><span class="line">        ion_injection_time = segment[<span class="hljs-string">'IonInjectionTime'</span>]</span><br><span class="line">        instrument_type = segment[<span class="hljs-string">'InstrumentType'</span>]</span><br><span class="line">        <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> segment[<span class="hljs-string">'data'</span>]:</span><br><span class="line">            data_list.append([scan, ret_time, ion_injection_time, instrument_type] + row)</span><br><span class="line">    </span><br><span class="line">    columns = [<span class="hljs-string">'Scan'</span>, <span class="hljs-string">'RetTime'</span>, <span class="hljs-string">'IonInjectionTime'</span>, <span class="hljs-string">'InstrumentType'</span>, <span class="hljs-string">'m/z'</span>,<span class="hljs-string">'Intensity'</span>]</span><br><span class="line">    df = pd.DataFrame(data_list, columns=columns)</span><br><span class="line">    <span class="hljs-keyword">return</span> df</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">def</span> <span class="title function_">parse_ms2_file</span>(<span class="hljs-params">filename</span>):</span><br><span class="line">    <span class="hljs-string">"""</span></span><br><span class="line"><span class="hljs-string">    Parse an MS2 file exported by RawConverter (or similar).</span></span><br><span class="line"><span class="hljs-string">    Returns a list of rows, each row is a dictionary of parsed data.</span></span><br><span class="line"><span class="hljs-string">    """</span></span><br><span class="line"></span><br><span class="line">    rows = []</span><br><span class="line">    current_scan = {}</span><br><span class="line">    current_charges = []  <span class="hljs-comment"># We'll store charge info here until we see fragments</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:</span><br><span class="line">        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:</span><br><span class="line">            line = line.strip()</span><br><span class="line">            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> line:</span><br><span class="line">                <span class="hljs-keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># Split line by whitespace or tabs</span></span><br><span class="line">            parts = line.split()</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># 1) S line: start a new scan</span></span><br><span class="line">            <span class="hljs-keyword">if</span> parts[<span class="hljs-number">0</span>] == <span class="hljs-string">'S'</span>:</span><br><span class="line">                <span class="hljs-comment"># Reset for new scan</span></span><br><span class="line">                current_scan = {</span><br><span class="line">                    <span class="hljs-string">'Scan'</span>: parts[<span class="hljs-number">1</span>],         <span class="hljs-comment"># e.g. 000009</span></span><br><span class="line">                    <span class="hljs-string">'Scan2'</span>: parts[<span class="hljs-number">2</span>],        <span class="hljs-comment"># sometimes the same as parts[1]</span></span><br><span class="line">                    <span class="hljs-string">'PrecursorMz'</span>: parts[<span class="hljs-number">3</span>],  <span class="hljs-comment"># e.g. 225.0737</span></span><br><span class="line">                    <span class="hljs-comment"># We'll add RetTime, IonInjectionTime, etc. as we encounter them</span></span><br><span class="line">                }</span><br><span class="line">                current_charges = []</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># 2) I line: scan-level metadata</span></span><br><span class="line">            <span class="hljs-keyword">elif</span> parts[<span class="hljs-number">0</span>] == <span class="hljs-string">'I'</span>:</span><br><span class="line">                <span class="hljs-comment"># e.g. I RetTime 0.69</span></span><br><span class="line">                key = parts[<span class="hljs-number">1</span>]</span><br><span class="line">                val = parts[<span class="hljs-number">2</span>] <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) &gt; <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-string">''</span></span><br><span class="line">                current_scan[key] = val</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># 3) Z line: charge line =&gt; Z 2 449.14012</span></span><br><span class="line">            <span class="hljs-keyword">elif</span> parts[<span class="hljs-number">0</span>] == <span class="hljs-string">'Z'</span>:</span><br><span class="line">                <span class="hljs-comment"># Format: Z &lt;charge&gt; &lt;precursor_mz&gt;</span></span><br><span class="line">                charge = parts[<span class="hljs-number">1</span>]</span><br><span class="line">                prec_mz = parts[<span class="hljs-number">2</span>]</span><br><span class="line">                current_charges.append((charge, prec_mz))</span><br><span class="line"></span><br><span class="line">            <span class="hljs-comment"># 4) Otherwise, if line starts with a float, it's presumably a fragment line</span></span><br><span class="line">            <span class="hljs-keyword">else</span>:</span><br><span class="line">                <span class="hljs-keyword">try</span>:</span><br><span class="line">                    float_vals = [<span class="hljs-built_in">float</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> parts]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                    <span class="hljs-keyword">if</span> current_charges:</span><br><span class="line">                        <span class="hljs-keyword">for</span> (c, pmz) <span class="hljs-keyword">in</span> current_charges:</span><br><span class="line">                            row = current_scan.copy()</span><br><span class="line">                            row[<span class="hljs-string">'Charge'</span>] = c</span><br><span class="line">                            row[<span class="hljs-string">'ChargePrecursorMz'</span>] = pmz</span><br><span class="line">                            <span class="hljs-keyword">for</span> idx, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(float_vals):</span><br><span class="line">                                row[<span class="hljs-string">f'FragVal_<span class="hljs-subst">{idx+<span class="hljs-number">1</span>}</span>'</span>] = val</span><br><span class="line">                            rows.append(row)</span><br><span class="line">                    <span class="hljs-keyword">else</span>:</span><br><span class="line">                        <span class="hljs-comment"># If no Z line has appeared yet, store a single row with blank charge</span></span><br><span class="line">                        row = current_scan.copy()</span><br><span class="line">                        row[<span class="hljs-string">'Charge'</span>] = <span class="hljs-string">''</span></span><br><span class="line">                        row[<span class="hljs-string">'ChargePrecursorMz'</span>] = <span class="hljs-string">''</span></span><br><span class="line">                        <span class="hljs-keyword">for</span> idx, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(float_vals):</span><br><span class="line">                            row[<span class="hljs-string">f'FragVal_<span class="hljs-subst">{idx+<span class="hljs-number">1</span>}</span>'</span>] = val</span><br><span class="line">                        rows.append(row)</span><br><span class="line"></span><br><span class="line">                <span class="hljs-keyword">except</span> ValueError:</span><br><span class="line">                    <span class="hljs-comment"># Not a numeric fragment line; ignore or handle differently</span></span><br><span class="line">                    <span class="hljs-keyword">pass</span></span><br><span class="line">    df = pd.DataFrame(rows)</span><br><span class="line">    cols = [</span><br><span class="line">        <span class="hljs-string">'Scan'</span>,  <span class="hljs-string">'PrecursorMz'</span>,</span><br><span class="line">        <span class="hljs-string">'RetTime'</span>, <span class="hljs-string">'IonInjectionTime'</span>, <span class="hljs-string">'ActivationType'</span>, <span class="hljs-string">'InstrumentType'</span>,</span><br><span class="line">        <span class="hljs-string">'TemperatureFTAnalyzer'</span>, <span class="hljs-string">'Filter'</span>, <span class="hljs-string">'PrecursorScan'</span>, <span class="hljs-string">'PrecursorInt'</span>,</span><br><span class="line">        <span class="hljs-string">'Charge'</span>, <span class="hljs-string">'ChargePrecursorMz'</span>,</span><br><span class="line">    ]</span><br><span class="line">    frag_cols = [c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> df.columns <span class="hljs-keyword">if</span> c.startswith(<span class="hljs-string">'FragVal_'</span>)]</span><br><span class="line">    <span class="hljs-comment"># Create final column order</span></span><br><span class="line">    final_cols = [c <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> cols <span class="hljs-keyword">if</span> c <span class="hljs-keyword">in</span> df.columns] + frag_cols</span><br><span class="line">    df = df[final_cols]</span><br><span class="line">    df[<span class="hljs-string">'RetTime'</span>] = df[<span class="hljs-string">'RetTime'</span>].astype(<span class="hljs-built_in">float</span>)</span><br><span class="line">    df =          df.rename(columns = {<span class="hljs-string">"FragVal_1"</span>:<span class="hljs-string">'m/z'</span>,<span class="hljs-string">'FragVal_2'</span>:<span class="hljs-string">'Intensity'</span>}, )</span><br><span class="line">    <span class="hljs-keyword">return</span> df</span><br></pre></td></tr></tbody></table></figure>

<p>Load MS1 and MS2 data</p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">filename = <span class="hljs-string">'./raw_data/20250312_tunning/MS2_trial_res30K_HCD20%_MIT1000.ms1'</span>  <span class="hljs-comment"># Adjust to your file path</span></span><br><span class="line">hcd20_ms1 = ms1_segment_scan_read(filename)</span><br><span class="line">filename = <span class="hljs-string">'./raw_data/20250312_tunning/MS2_trial_res30K_HCD20%_MIT1000.ms2'</span></span><br><span class="line">hcd20_ms2 = parse_ms2_file(filename)</span><br><span class="line"><span class="hljs-built_in">print</span> (<span class="hljs-built_in">len</span>(hcd20_ms2[<span class="hljs-string">'Scan'</span>].unique()),<span class="hljs-built_in">len</span>(hcd20_ms1[<span class="hljs-string">'Scan'</span>].unique()))</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">tar_mz   = <span class="hljs-number">197.04248</span></span><br><span class="line">sample_start,sample_end  = <span class="hljs-number">37.00</span>,<span class="hljs-number">45.00</span></span><br><span class="line">ms1_scan = <span class="hljs-number">2242</span></span><br><span class="line"></span><br><span class="line">fig = make_subplots(</span><br><span class="line">    rows=<span class="hljs-number">1</span>, cols=<span class="hljs-number">2</span>,</span><br><span class="line">    subplot_titles=(<span class="hljs-string">"MS1 Profile around m/z  197.04248 (C7H12NaO5+)"</span>,<span class="hljs-string">'MS2 fragmentation spectra'</span>),</span><br><span class="line">    vertical_spacing=<span class="hljs-number">0.1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">sel_ms1_df = df_ms1[(df_ms1[<span class="hljs-string">'m/z'</span>]&gt;tar_mz-<span class="hljs-number">1</span>)&amp;(df_ms1[<span class="hljs-string">'m/z'</span>]&lt;tar_mz+<span class="hljs-number">1</span>)]</span><br><span class="line">fig.add_trace(go.Bar(</span><br><span class="line">    x=sel_ms1_df[sel_ms1_df[<span class="hljs-string">'Scan'</span>] == ms1_scan][<span class="hljs-string">'m/z'</span>],  <span class="hljs-comment"># x-axis: m/z values</span></span><br><span class="line">    y=sel_ms1_df[sel_ms1_df[<span class="hljs-string">'Scan'</span>] == ms1_scan][<span class="hljs-string">'Intensity'</span>],  <span class="hljs-comment"># y-axis: Intensity values</span></span><br><span class="line">    name=<span class="hljs-string">"MS1"</span>,  <span class="hljs-comment"># Name for the legend</span></span><br><span class="line">    marker=<span class="hljs-built_in">dict</span>(color=<span class="hljs-string">'blue'</span>)  <span class="hljs-comment"># Customize bar color</span></span><br><span class="line">), row=<span class="hljs-number">1</span>, col=<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">tolerance = <span class="hljs-number">0.02</span></span><br><span class="line"></span><br><span class="line">precursor_mz_array = df_ms2[<span class="hljs-string">'PrecursorMz'</span>].unique()</span><br><span class="line">precursor_mz_numeric = precursor_mz_array.astype(<span class="hljs-built_in">float</span>)</span><br><span class="line">selected_mz = precursor_mz_array[</span><br><span class="line">    (precursor_mz_numeric &gt;= tar_mz - tolerance) &amp; </span><br><span class="line">    (precursor_mz_numeric &lt;= tar_mz + tolerance)</span><br><span class="line">]</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">sel_ms2_df = df_ms2[(df_ms2[<span class="hljs-string">'PrecursorMz'</span>].isin(selected_mz))&amp; (df_ms2[<span class="hljs-string">'RetTime'</span>]&gt;sample_start)&amp;(df_ms2[<span class="hljs-string">'RetTime'</span>]&lt;sample_end)]</span><br><span class="line">sel_ms2_df = sel_ms2_df.sort_values(by =<span class="hljs-string">'m/z'</span>)</span><br><span class="line">fig.add_trace(go.Bar(</span><br><span class="line">    x=sel_ms2_df[<span class="hljs-string">'m/z'</span>],  <span class="hljs-comment"># x-axis: m/z values</span></span><br><span class="line">    y=sel_ms2_df[<span class="hljs-string">'Intensity'</span>],  <span class="hljs-comment"># y-axis: Intensity values</span></span><br><span class="line">    name=<span class="hljs-string">"MS2"</span>, hovertext=sel_ms2_df[<span class="hljs-string">'RetTime'</span>],<span class="hljs-comment"># Name for the legend</span></span><br><span class="line">    marker=<span class="hljs-built_in">dict</span>(color=<span class="hljs-string">'red'</span>)  <span class="hljs-comment"># Customize bar color</span></span><br><span class="line">), row=<span class="hljs-number">1</span>, col=<span class="hljs-number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fig.update_xaxes(title_text=<span class="hljs-string">"m/z"</span>,<span class="hljs-built_in">range</span> = [tar_mz - <span class="hljs-number">0.2</span>, tar_mz+<span class="hljs-number">0.2</span>], showline=<span class="hljs-literal">True</span>, linecolor=<span class="hljs-string">'black'</span>, title_font=<span class="hljs-built_in">dict</span>(size=<span class="hljs-number">14</span>, color=<span class="hljs-string">'black'</span>),col = <span class="hljs-number">1</span>,row = <span class="hljs-number">1</span>)</span><br><span class="line">fig.update_yaxes(title_text=<span class="hljs-string">"Intensity"</span>, showline=<span class="hljs-literal">True</span>, linecolor=<span class="hljs-string">'black'</span>,<span class="hljs-built_in">range</span> = [<span class="hljs-number">0</span>, <span class="hljs-literal">None</span>], title_font=<span class="hljs-built_in">dict</span>(size=<span class="hljs-number">14</span>, color=<span class="hljs-string">'black'</span>),col = <span class="hljs-number">1</span>,row = <span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">fig.update_xaxes(title_text=<span class="hljs-string">"m/z"</span>, showline=<span class="hljs-literal">True</span>, linecolor=<span class="hljs-string">'black'</span>, title_font=<span class="hljs-built_in">dict</span>(size=<span class="hljs-number">14</span>, color=<span class="hljs-string">'black'</span>),col = <span class="hljs-number">2</span>,row = <span class="hljs-number">1</span>)</span><br><span class="line">fig.update_yaxes(title_text=<span class="hljs-string">"Intensity"</span>, showline=<span class="hljs-literal">True</span>, linecolor=<span class="hljs-string">'black'</span>,<span class="hljs-built_in">range</span> = [<span class="hljs-number">0</span>, <span class="hljs-literal">None</span>], title_font=<span class="hljs-built_in">dict</span>(size=<span class="hljs-number">14</span>, color=<span class="hljs-string">'black'</span>),col = <span class="hljs-number">2</span>,row = <span class="hljs-number">1</span>)</span><br><span class="line">fig.update_layout(title_text=<span class="hljs-string">''</span>, width=<span class="hljs-number">1200</span>, height=<span class="hljs-number">450</span>, showlegend=<span class="hljs-literal">False</span>, plot_bgcolor=<span class="hljs-string">'white'</span>)</span><br><span class="line">fig.show()</span><br></pre></td></tr></tbody></table></figure>
<p>Below is an example where the MS1 signal was strong, but the corresponding MS2 spectrum failed to produce meaningful fragments, likely due to poor fragmentation settings or low ion injection efficiency. </p>
<p><img src="/images/MS2/Fig.bad_example_of_no_meaningful_MS2.png"></p>
<h2 id="4-Tool-recommendation-for-MS2-data-processing"><a href="#4-Tool-recommendation-for-MS2-data-processing" class="headerlink" title="4. Tool recommendation for MS2 data processing"></a>4. Tool recommendation for MS2 data processing</h2><h3 id="4-1-MetFrag"><a href="#4-1-MetFrag" class="headerlink" title="4.1 MetFrag"></a>4.1 <a target="_blank" rel="noopener" href="https://msbi.ipb-halle.de/MetFrag/">MetFrag</a></h3><p>A web-based tool for in-silico fragmentation and metabolite annotation. It is commonly used for identifying small molecules based on MS2 spectra.</p>
<h3 id="4-2-CFM-ID"><a href="#4-2-CFM-ID" class="headerlink" title="4.2 CFM-ID"></a>4.2 <a target="_blank" rel="noopener" href="https://cfmid.wishartlab.com/">CFM-ID</a></h3><p>Another tool for predicting MS2 fragmentation patterns, supporting different collision energies.<br>Note: The website is often unstable and may be temporarily inaccessible.</p>
<h3 id="4-3-MassBank"><a href="#4-3-MassBank" class="headerlink" title="4.3 MassBank"></a>4.3 <a target="_blank" rel="noopener" href="https://massbank.eu/MassBank/">MassBank</a></h3><p>Unlike MetFrag and CFM-ID, MassBank provides a searchable database of experimentally acquired MS2 spectra. Users can compare their spectra to community-uploaded reference data under similar experimental conditions.</p>
<h3 id="4-4-MSBuddy"><a href="#4-4-MSBuddy" class="headerlink" title="4.4 MSBuddy"></a>4.4 <a target="_blank" rel="noopener" href="https://github.com/Philipbear/msbuddy">MSBuddy</a></h3><p><img src="/images/MS2/Fig.MSBuddy.png">     </p>
<p>MSBuddy is an open-source, Python-based tool designed for molecular formula assignment with MS/MS (MS2) assistance. It is particularly useful for reducing ambiguity in formula annotation, though it is not intended for structural elucidation.</p>
<p>The tool is simple to use and accepts <code>.mgf</code> files as input. An example worlflow can be seen as follows:    </p>
<figure class="highlight python hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> tarfile  <span class="hljs-comment"># Use standard tarfile instead of backports</span></span><br><span class="line"><span class="hljs-keyword">import</span> pkg_resources</span><br><span class="line"><span class="hljs-keyword">from</span> msbuddy <span class="hljs-keyword">import</span> Msbuddy, MsbuddyConfig</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Print the MSBuddy version</span></span><br><span class="line"><span class="hljs-built_in">print</span>(<span class="hljs-string">f"MSBuddy version: <span class="hljs-subst">{pkg_resources.get_distribution(<span class="hljs-string">'msbuddy'</span>).version}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Define MSBuddy parameters</span></span><br><span class="line">msb_config = MsbuddyConfig(</span><br><span class="line">    ms_instr=<span class="hljs-string">"orbitrap"</span>,  <span class="hljs-comment"># Instrument type</span></span><br><span class="line">    ppm=<span class="hljs-literal">True</span>,</span><br><span class="line">    ms1_tol=<span class="hljs-number">10</span>,            <span class="hljs-comment"># MS1 tolerance (ppm)</span></span><br><span class="line">    ms2_tol=<span class="hljs-number">20</span>,            <span class="hljs-comment"># MS2 tolerance (ppm)</span></span><br><span class="line">    halogen=<span class="hljs-literal">True</span>,</span><br><span class="line">    timeout_secs=<span class="hljs-number">200</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Specify the adducts to consider</span></span><br><span class="line">msb_config.adduct = [<span class="hljs-string">"[M+H]+"</span>, <span class="hljs-string">"[M+Na]+"</span>]</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Instantiate the engine and load the .mgf file</span></span><br><span class="line">msb_engine = Msbuddy(msb_config)</span><br><span class="line">msb_engine.load_mgf(<span class="hljs-string">'./raw_data/20250312_tunning/20250314_test_amb_aged/MS2_trial_res60K_HCD80%_Punjab_ambient.mgf'</span>)</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Perform formula annotation</span></span><br><span class="line">msb_engine.annotate_formula()</span><br><span class="line">results = msb_engine.get_summary()</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"># Print the results</span></span><br><span class="line"><span class="hljs-keyword">for</span> individual_result <span class="hljs-keyword">in</span> results:</span><br><span class="line">    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> individual_result.items():</span><br><span class="line">        <span class="hljs-built_in">print</span>(key, value)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>The output shows a successful identification of a likely molecular formula using MS2-assisted annotation:</p>
<figure class="highlight bash hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">adduct [M+H]+</span><br><span class="line">formula_rank_1 C9H10N2</span><br><span class="line">estimated_fdr 0.00536238379855114</span><br><span class="line">formula_rank_2 C6H11FN2O</span><br><span class="line">formula_rank_3 None</span><br><span class="line">formula_rank_4 None</span><br><span class="line">formula_rank_5 None</span><br></pre></td></tr></tbody></table></figure>
<p>In this case, MS2 fragments supported <em>C9H10N2</em> is the most probable formula. </p>
<h3 id="4-5-SIRIUS"><a href="#4-5-SIRIUS" class="headerlink" title="4.5 SIRIUS"></a>4.5 <a target="_blank" rel="noopener" href="https://boecker-lab.github.io/docs.sirius.github.io/">SIRIUS</a></h3><p><img src="/images/MS2/Fig.SIRIUS_paper.png">  </p>
<p>SIRIUS platform is a GUI-based software for analyzing MS2 datasets (It also has command line version which I have not tried yet). SIRIUS combines library matching, in-silico fragmentation, and de novo molecular formula prediction to rank candidate molecular structures based on how well they match observed MS2 fragments.    </p>
<p>Below is an example output from my dataset, showcasing the top-ranked structure based on fragment scoring</p>
<p><img src="/images/MS2/Fig.Results_from_SIRIUS.png"> </p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><p>Assress, H. A.; Ferruzzi, M. G.; Lan, R. S.<br>Optimization of Mass Spectrometric Parameters in Data Dependent Acquisition for Untargeted Metabolomics on the Basis of Putative Assignments.<br>J. Am. Soc. Mass Spectrom. 2023, 34(8), 1621–1631. <a target="_blank" rel="noopener" href="https://doi.org/10.1021/jasms.3c00084">https://doi.org/10.1021/jasms.3c00084</a></p>
</li>
<li><p>Defossez E, Bourquin J, von Reuss S, et al. Eight key rules for successful data‐dependent acquisition in mass spectrometry‐based metabolomics[J]. Mass Spectrometry Reviews, 2023, 42(1): 131-143. <a target="_blank" rel="noopener" href="https://analyticalsciencejournals.onlinelibrary.wiley.com/doi/full/10.1002/mas.21715">https://analyticalsciencejournals.onlinelibrary.wiley.com/doi/full/10.1002/mas.21715</a></p>
</li>
<li><p>McEachran, A. D., Balabin, I., Cathey, T., Transue, T. R., Al-Ghoul, H., Grulke, C., … &amp; Williams, A. J. (2019). Linking in silico MS/MS spectra with chemistry data to improve identification of unknowns. Scientific Data, 6(1), 141. <a target="_blank" rel="noopener" href="https://www.nature.com/articles/s41597-019-0145-z">https://www.nature.com/articles/s41597-019-0145-z</a></p>
</li>
<li><p>Xing, S., Shen, S., Xu, B., Li, X., &amp; Huan, T. (2023). BUDDY: molecular formula discovery via bottom-up MS/MS interrogation. Nature Methods, 20(6), 881-890. <a target="_blank" rel="noopener" href="https://www.nature.com/articles/s41592-023-01850-x">https://www.nature.com/articles/s41592-023-01850-x</a></p>
</li>
<li><p>Dührkop, K., Fleischauer, M., Ludwig, M., Aksenov, A. A., Melnik, A. V., Meusel, M., … &amp; Böcker, S. (2019). SIRIUS 4: a rapid tool for turning tandem mass spectra into metabolite structure information. Nature methods, 16(4), 299-302. <a target="_blank" rel="noopener" href="https://www.nature.com/articles/s41592-019-0344-8">https://www.nature.com/articles/s41592-019-0344-8</a></p>
</li>
</ol>
</body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Orbitrap/">#Orbitrap</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Mass-Spectrometry/">#Mass Spectrometry</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2025/06/20/42.%5BModel%5DFLEXPART.V11_ECMWF_supported_installation/">Installing FLEXPART v11 with ECMWF Support</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2025/03/05/40.%5BMS%5DVisualizing-Chemical-Structures/">Visualizing Chemical Structures 绘制化学物质的结构式</a>
            
        </span>
    </div>
    
</article>




<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'http://envhyf.github.io/2025/04/01/41.[MS]From_Formula_to%20Function_Inferring_Compound_Class_from_MS1+MS2/';
        this.page.identifier = '2025/04/01/41.[MS]From_Formula_to Function_Inferring_Compound_Class_from_MS1+MS2/';
        
        this.language = 'zh';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'taipingta' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2025 Hao Yufang&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("zh-CN");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery > p > .gallery-item').unwrap();
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    

    



<script src="/js/script.js"></script>


    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>

    
</body>
</html>